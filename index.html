<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Jeico Streaming | Store</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link href="https://fonts.googleapis.com/css2?family=Righteous&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  


<style id="style-style.css">/* style.css */
/* =========================================================
   ESTILOS CLIENTE - THEME GOTH (DARKNESS & PURPLE) - OPTIMIZADO
   ========================================================= */
@import url('https://fonts.googleapis.com/css2?family=Righteous&family=Inter:wght@300;400;600;800&display=swap');

/* =========================================================
   1. VARIABLES Y RESET
   ========================================================= */
:root {
  --bg-dark: #000000;
  --bg-card: #0a0a0a;
  --bg-sidebar: #050505;
  --border-color: #1f1f1f;
  
  --accent: #7c3aed;
  --accent-hover: #6d28d9;
  --accent-glow: rgba(124, 58, 237, 0.4);
  
  --text-white: #e5e5e5;
  --text-gray: #737373;
  
  --success: #059669;
  --danger: #9f1239;
  
  --sidebar-w: 260px;
}

* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
body { background-color: var(--bg-dark); color: var(--text-white); overflow-x: hidden; }

/* =========================================================
   2. UTILIDADES GENERALES & ANIMACIONES
   ========================================================= */
.hidden { display: none !important; }
.overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); z-index: 900; }
.view-container { width: 100%; min-height: 100vh; }
.text-center { text-align: center; }
.text-right { text-align: right; }
.text-accent { color: var(--accent); text-shadow: 0 0 20px rgba(124, 58, 237, 0.4); }
.fa-spin { animation: spin 1s infinite linear; }

@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
@keyframes shineText { to { background-position: 200% center; } }
@keyframes shineHeroText { to { background-position: 200% center; } }
@keyframes floating { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-15px) rotate(5deg); } }
@keyframes glowPulse { from { transform: scale(1); opacity: 0.4; } to { transform: scale(1.4); opacity: 0.7; } }
@keyframes pulseStatus { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.4; transform: scale(1.2); } 100% { opacity: 1; transform: scale(1); } }

/* =========================================================
   3. LOGIN Y RECUPERACI√ìN (PANTALLA INICIAL)
   ========================================================= */
#login-view { display: flex; align-items: center; justify-content: center; background: linear-gradient(180deg, #000 0%, #11001c 100%); position: relative; }
.login-banner-bg { position: absolute; top: 0; left: 0; width: 100%; height: 60vh; background-image: url('https://drive.google.com/thumbnail?id=1Yj6I6w5qDjBR20krMqzw9FL4nFwWTJxN&sz=w1920'); background-size: cover; background-position: center top; z-index: 0; mask-image: linear-gradient(to bottom, black 40%, transparent 100%); -webkit-mask-image: linear-gradient(to bottom, black 40%, transparent 100%); }

.login-box { position: relative; z-index: 10; width: 100%; max-width: 400px; padding: 50px 40px !important; background: rgba(10, 10, 10, 0.8) !important; backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.05) !important; border-radius: 28px !important; text-align: center; box-shadow: 0 0 30px rgba(124, 58, 237, 0.1); }

.vault-header { color: #fff; font-family: 'Righteous', cursive; font-size: 1.1rem; letter-spacing: 5px; margin-bottom: 35px; text-transform: uppercase; text-shadow: 0 0 15px rgba(124, 58, 237, 0.6); background: linear-gradient(to right, #fff, var(--accent), #fff); -webkit-background-clip: text; background-size: 200% auto; animation: shineText 5s linear infinite; }
.verify-header { color: #3b82f6; font-family: 'Righteous'; font-size: 1.1rem; letter-spacing: 3px; margin-bottom: 5px; }
.success-header { color: #10b981; font-family: 'Righteous'; font-size: 1.1rem; letter-spacing: 3px; margin-bottom: 5px; }

.input-group { position: relative; width: 100%; display: flex; align-items: center; margin-bottom: 15px; }
.input-field { width: 100%; box-sizing: border-box; background: rgba(255, 255, 255, 0.03) !important; border: 1px solid rgba(255, 255, 255, 0.1) !important; color: #fff !important; padding: 16px 20px !important; border-radius: 16px !important; font-size: 0.95rem !important; outline: none !important; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important; }
.input-field:focus { background: rgba(124, 58, 237, 0.07) !important; border-color: var(--accent) !important; box-shadow: 0 0 20px rgba(124, 58, 237, 0.2) !important; transform: translateY(-1px); }
.input-field#pass { padding-right: 50px !important; }

.eye-icon { position: absolute; right: 18px; color: var(--text-gray); cursor: pointer; font-size: 1.3rem; transition: all 0.3s ease; user-select: none; z-index: 10; }
.eye-icon:hover { color: var(--accent); text-shadow: 0 0 10px var(--accent-glow); }

.btn-login { width: 100%; background: linear-gradient(135deg, var(--accent), #6366f1); color: white; border: none; padding: 16px; border-radius: 16px; font-weight: 800; text-transform: uppercase; letter-spacing: 2px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 10px 20px -5px rgba(124, 58, 237, 0.4); margin-top: 10px; }
.btn-login:hover { transform: scale(1.02); box-shadow: 0 15px 30px -5px rgba(124, 58, 237, 0.6); filter: brightness(1.1); }
.btn-login:active { transform: scale(0.98); }
.btn-verify { background: #3b82f6 !important; }
.btn-success { background: #10b981 !important; color: #000 !important; }

.forgot-password-link { display: inline-block; color: #666; font-size: 0.75rem; background: none; border: none; padding: 0 0 2px 0; margin-top: 20px; cursor: pointer; letter-spacing: 1.5px; font-weight: 600; text-transform: uppercase; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); position: relative; }
.forgot-password-link::after { content: ''; position: absolute; width: 0; height: 1px; bottom: 0; left: 50%; background: var(--accent); transition: all 0.3s ease; transform: translateX(-50%); box-shadow: 0 0 8px var(--accent); }
.forgot-password-link:hover { color: var(--accent); transform: translateY(-1px); }
.forgot-password-link:hover::after { width: 60%; }

.reminder-text, .step-description { color: var(--text-gray); font-size: 0.75rem; font-weight: 500; margin-bottom: 25px; text-align: center; line-height: 1.4; }

.back-container { display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 25px; padding: 12px; border-radius: 12px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.05); color: #555; cursor: pointer; transition: all 0.3s ease; width: 100%; }
.back-container span { font-size: 0.75rem; font-weight: 800; letter-spacing: 2px; text-transform: uppercase; }
.back-container:hover { background: rgba(255, 255, 255, 0.08); border-color: rgba(255, 255, 255, 0.15); color: #fff; transform: translateX(-5px); }

/* =========================================================
   4. LAYOUT PRINCIPAL (SIDEBAR Y MAIN)
   ========================================================= */
.sidebar { width: var(--sidebar-w); background: var(--bg-sidebar); height: 100vh; position: fixed; display: flex; flex-direction: column; border-right: 1px solid var(--border-color); z-index: 100; overflow-y: auto; }
.main-content { margin-left: var(--sidebar-w); flex-grow: 1; padding: 40px; position: relative; }

.logo { display: flex; align-items: center; gap: 12px; padding: 30px 20px; flex-shrink: 0; user-select: none; overflow: hidden; }
.logo-img { height: 42px; width: auto; object-fit: contain; border-radius: 8px; filter: drop-shadow(0 0 8px rgba(99, 102, 241, 0.6)); transition: transform 0.3s ease; }
.logo:hover .logo-img { transform: scale(1.1) rotate(-3deg); }
.logo h2 { font-family: 'Righteous', cursive; font-size: 1.4rem; font-weight: 400; margin: 0; line-height: 1; letter-spacing: 1px; text-transform: uppercase; background: linear-gradient(to bottom, #ffffff 0%, #a5b4fc 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.5)); }

.nav-links { list-style: none; padding: 20px; flex-grow: 1; margin-bottom: 10px; }
.nav-item { display: flex; align-items: center; gap: 15px; padding: 16px 20px; color: var(--text-gray); cursor: pointer; font-weight: 600; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1px; transition: 0.3s; margin-bottom: 5px; }
.nav-item .material-icons-round { font-size: 1.3rem; }
.nav-item-content { display: flex; align-items: center; gap: 12px; width: 100%; }
.nav-item:hover { color: white; border-left: 3px solid var(--accent); background: linear-gradient(90deg, rgba(124,58,237,0.1), transparent); }
.nav-item.active { color: var(--accent); border-left: 3px solid var(--accent); background: linear-gradient(90deg, rgba(124,58,237,0.2), transparent); }
.logout-link { margin-top: auto; }

.submenu { list-style: none; padding-left: 20px; margin-bottom: 10px; overflow: hidden; transition: max-height 0.3s ease-out; }
.submenu-item { padding: 12px 15px; color: var(--text-gray); font-size: 0.8rem; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 10px; border-left: 1px solid #333; text-transform: uppercase; letter-spacing: 1px; }
.submenu-item:hover { background: rgba(255,255,255,0.05); color: white; border-color: var(--accent); }
.arrow-icon { transition: transform 0.3s; margin-left: auto; }
.nav-item.open .arrow-icon { transform: rotate(180deg); }

.user-sidebar-info { margin: 15px 15px 25px 15px; padding: 15px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 16px; display: flex; align-items: center; gap: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
.user-name { font-size: 0.85rem; font-weight: 700; color: #fff; text-transform: uppercase; letter-spacing: 1px; display: block; margin-bottom: 5px; }
.user-balance { color: var(--success); font-weight: 800; font-family: 'Inter', monospace; font-size: 1.1rem; text-shadow: 0 0 10px rgba(5, 150, 105, 0.4); }

/* =========================================================
   5. COMPONENTES PRINCIPALES (HERO, CABECERAS)
   ========================================================= */
#sec-inicio { animation: fadeIn 0.5s ease-in-out; }

.page-title { font-size: 2.5rem; font-weight: 800; margin-bottom: 40px; letter-spacing: -1px; text-transform: uppercase; background: linear-gradient(to right, #fff, #666); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.page-header-premium { margin-bottom: 40px; }
.page-subtitle { color: var(--text-gray); font-size: 0.9rem; margin-top: -30px; letter-spacing: 1px; }
.section-header-premium { margin-bottom: 40px; }
.section-description { color: var(--text-gray); font-size: 0.9rem; margin-top: -30px; }

.hero-container { background: radial-gradient(circle at top, #1a0b2e 0%, #000000 80%); color: white; text-align: center; padding: 80px 20px; border-radius: 20px; margin-bottom: 50px; border: 1px solid var(--border-color); box-shadow: 0 0 50px rgba(0,0,0,0.5); }
.hero-content h1 { font-family: 'Righteous', cursive; font-size: clamp(2rem, 4.5vw, 3.2rem); font-weight: 800; text-transform: uppercase; letter-spacing: 2px; line-height: 1.2; margin-bottom: 20px; background: linear-gradient(to right, #ffffff 20%, #a855f7 50%, #7c3aed 80%, #ffffff 100%); background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0px 6px 12px rgba(124, 58, 237, 0.4)); animation: shineHeroText 5s linear infinite; }
.hero-content p { font-size: 1rem; color: #a3a3a3; max-width: 600px; margin: 0 auto 30px auto; line-height: 1.6; font-weight: 400; }
.cta-button { background: var(--accent); color: white; padding: 16px 40px; text-decoration: none; font-weight: 700; border-radius: 4px; transition: all 0.3s ease; display: inline-block; text-transform: uppercase; letter-spacing: 1px; border: 1px solid var(--accent); box-shadow: 0 0 15px var(--accent-glow); cursor: pointer; }
.cta-button:hover { background: var(--accent-hover); transform: translateY(-2px); box-shadow: 0 0 30px var(--accent-glow); color: #fff; }

.features-grid { display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; margin-top: 50px; }
.feature-card { background: #0a0a0a; padding: 30px; border-radius: 10px; width: 280px; border: 1px solid #222; transition: transform 0.3s, border-color 0.3s; }
.feature-card:hover { transform: translateY(-5px); border-color: var(--accent); }
.feature-icon { font-size: 2rem; margin-bottom: 15px; display: block; filter: drop-shadow(0 0 5px rgba(255,255,255,0.3)); }
.feature-title { font-weight: 700; color: #fff; margin-bottom: 10px; display: block; font-size: 1.1rem; text-transform: uppercase; }
.feature-desc { font-size: 0.9rem; color: #666; line-height: 1.4; }

/* =========================================================
   6. TARJETAS (TIENDA Y PEDIDOS)
   ========================================================= */
.products-grid, .orders-premium-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; padding: 20px 0; }
.orders-premium-grid { grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; padding: 10px; }

.product-card { background: #0a0a0a; border: 1px solid #1a1a1a; border-radius: 12px; transition: all 0.4s ease; display: flex; flex-direction: column; position: relative; height: 480px; overflow: hidden; }
.product-card:hover { transform: translateY(-10px); border-color: var(--accent); box-shadow: 0 10px 30px rgba(0,0,0,1), 0 0 20px var(--accent-glow); }
.card-img-container { height: 50%; width: 100%; overflow: hidden; background: #111; position: relative; display: flex; align-items: center; justify-content: center; border-bottom: 1px solid var(--border-color); }
.card-img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.6s ease; }
.product-card:hover .card-img { transform: scale(1.1); }
.card-body { padding: 25px; text-align: center; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; background: linear-gradient(180deg, #0a0a0a 0%, #050505 100%); }
.card-title { font-family: 'Righteous', cursive; font-weight: 400; font-size: 1.2rem; text-transform: uppercase; color: #fff; letter-spacing: 1px; }
.price-container { margin: 10px 0; }
.card-price { font-size: 1.6rem; color: var(--accent); font-weight: 800; text-shadow: 0 0 10px var(--accent-glow); }
.card-stock { font-size: 0.8rem; color: var(--text-gray); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; }
.btn-buy { width: 100%; padding: 14px; border: 1px solid var(--accent); background: rgba(124, 58, 237, 0.05); color: var(--accent); font-weight: 800; cursor: pointer; text-transform: uppercase; font-size: 0.85rem; transition: 0.3s; letter-spacing: 2px; }
.btn-buy:hover { background: var(--accent); color: white; box-shadow: 0 0 20px var(--accent-glow); }

.product-card.sold-out { filter: grayscale(0.8); opacity: 0.7; border-color: #333 !important; }
.product-card.sold-out:hover { transform: none; box-shadow: none; }
.product-card.sold-out .card-price { color: #444; text-shadow: none; }
.btn-buy.disabled { border-color: #333; color: #555; background: #111; cursor: not-allowed; }
.btn-buy.disabled:hover { box-shadow: none; color: #666; background: #111; }
.sold-out-badge { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg); background: var(--danger); color: white; padding: 8px 20px; font-weight: 900; font-size: 1rem; border: 2px solid white; z-index: 10; box-shadow: 0 0 20px rgba(0,0,0,0.5); }

/* =========================================================
   7. BILLETERA
   ========================================================= */
.wallet-card { background: linear-gradient(135deg, #4f46e5 0%, #a855f7 100%); padding: 40px; border-radius: 24px; text-align: center; color: white; box-shadow: 0 20px 50px rgba(79, 70, 229, 0.3); margin-bottom: 30px; position: relative; overflow: hidden; }
.wallet-card::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%); pointer-events: none; }
.wallet-label { font-size: 1rem; font-weight: 500; opacity: 0.9; text-transform: uppercase; letter-spacing: 1px; }
.wallet-amount { font-size: 4rem; font-weight: 800; margin: 10px 0 30px 0; font-family: 'Inter', sans-serif; text-shadow: 0 5px 15px rgba(0,0,0,0.2); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
.wallet-amount:active { transform: scale(1.1); }
.wallet-actions { display: flex; justify-content: center; gap: 15px; }
.btn-wallet-action { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 10px 20px; border-radius: 50px; font-weight: 600; cursor: pointer; backdrop-filter: blur(5px); transition: 0.3s; display: flex; align-items: center; gap: 8px; }
.btn-wallet-action:hover { background: white; color: #4f46e5; }

.history-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
.table-responsive-wrapper { width: 100%; overflow-x: auto; }
.premium-table { width: 100%; border-collapse: collapse; }
.premium-table thead th { background: #050505; color: #444; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 2px; padding: 15px; border-bottom: 1px solid #1a1a1a; text-align: center; }
.wallet-row-premium { border-bottom: 1px solid #111; transition: background 0.3s; }
.wallet-row-premium:hover { background: rgba(124, 58, 237, 0.05); }
#wallet-history tr td { vertical-align: middle; padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); }
.table-loading-msg { text-align: center; padding: 60px; color: #555; }

/* =========================================================
   8. CARRITO Y CHECKOUT
   ========================================================= */
.floating-cart-btn { position: fixed; bottom: 30px; right: 30px; background: var(--accent); color: white; width: 65px; height: 65px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 20px var(--accent-glow); cursor: pointer; z-index: 800; transition: transform 0.3s, opacity 0.3s, background 0.3s; border: none; }
.floating-cart-btn:hover { transform: scale(1.1); background: var(--accent-hover); }
.cart-icon-large { font-size: 32px; }
.cart-badge { position: absolute; top: -5px; right: -5px; background: var(--danger); color: white; width: 25px; height: 25px; border-radius: 50%; font-size: 0.8rem; font-weight: bold; display: flex; align-items: center; justify-content: center; border: 2px solid var(--bg-dark); }

.cart-drawer { position: fixed; top: 0; right: -400px; width: 350px; height: 100vh; background: #080808; border-left: 1px solid var(--border-color); z-index: 1000; transition: right 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); display: flex; flex-direction: column; box-shadow: -10px 0 50px rgba(0,0,0,0.8); }
.cart-drawer.open { right: 0; }
.drawer-header { padding: 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; background: #050505; }
.drawer-header h2 { font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; }
.btn-close-drawer { background: none; border: none; color: #fff; cursor: pointer; }
.drawer-body { flex-grow: 1; padding: 20px; overflow-y: auto; }
.empty-cart-msg { text-align: center; color: #444; margin-top: 30px; }
.drawer-footer { padding: 25px; border-top: 1px solid var(--border-color); background: #050505; }
.drawer-total { display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: 800; margin-bottom: 20px; }
.btn-checkout { width: 100%; padding: 15px; background: var(--success); color: white; border: none; font-weight: 800; text-transform: uppercase; cursor: pointer; transition: 0.3s; letter-spacing: 1px; }
.btn-continue { width: 100%; padding: 12px; background: transparent; color: var(--text-gray); border: 1px solid var(--border-color); margin-top: 10px; cursor: pointer; text-transform: uppercase; font-size: 0.8rem; transition: 0.3s; }
.btn-continue:hover { border-color: #fff; color: #fff; }

.checkout-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9); width: 90%; max-width: 600px; background: #0a0a0a; border: 1px solid var(--border-color); z-index: 1100; padding: 0; box-shadow: 0 0 50px rgba(0,0,0,0.8); opacity: 0; pointer-events: none; transition: 0.3s; }
.checkout-modal.active { opacity: 1; pointer-events: auto; transform: translate(-50%, -50%) scale(1); }
.checkout-header { background: var(--accent); padding: 15px 25px; color: white; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
.checkout-body { padding: 30px; max-height: 60vh; overflow-y: auto; }
.checkout-instruction { color: #777; margin-bottom: 20px; font-size: 0.85rem; text-align: center; }
.checkout-total-row { display: flex; justify-content: space-between; font-size: 1.5rem; font-weight: 800; color: var(--accent); margin-top: 20px; padding-top: 20px; border-top: 1px solid #333; }
.checkout-actions { padding: 20px; display: flex; gap: 15px; background: #050505; }
.btn-final-pay { flex: 1; background: var(--success); color: white; border: none; padding: 15px; font-weight: 800; cursor: pointer; text-transform: uppercase; }
.btn-final-cancel { flex: 1; background: #222; color: #fff; border: none; padding: 15px; font-weight: 600; cursor: pointer; text-transform: uppercase; }

/* =========================================================
   9. RESPONSIVE DESIGN UNIFICADO
   ========================================================= */
.hamburger-menu { display: none; }
.loading-container { grid-column: 1/-1; text-align: center; padding: 60px; }
.loading-text { color: var(--text-gray); margin-top: 20px; letter-spacing: 2px; font-size: 0.8rem; }

@media(max-width: 768px) {
  /* Hamburgesa activa */
  .hamburger-menu { display: flex; align-items: center; justify-content: center; position: fixed; top: 15px; left: 15px; z-index: 10000; background: #0a0a0a; border: 1px solid #222; color: #fff; padding: 8px; border-radius: 8px; cursor: pointer; backdrop-filter: blur(5px); }
  
  /* Sidebar Off-canvas */
  .sidebar { position: fixed; left: -320px; top: 0; bottom: 0; width: 280px; background: #050505; z-index: 9999; display: flex; flex-direction: column; padding-top: 70px; transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 20px 0 50px rgba(0,0,0,0.9); border-right: 1px solid #1a1a1a; }
  .sidebar.open { left: 0; }
  
  /* Main Content Ajustado */
  .main-content { margin-left: 0 !important; padding: 80px 20px 20px 20px; }
  
  /* Modificaciones Internas */
  .cart-drawer { width: 85%; }
  .hero-content h1 { font-size: 1.8rem; }
  .features-grid { flex-direction: column; align-items: center; }
  .orders-premium-grid { grid-template-columns: 1fr; }
}

@media (max-width: 480px) {
  .brand-name { font-size: 2.2rem; }
  .brand-subtitle { font-size: 0.7rem; letter-spacing: 5px; }
  .logo-glow-container { width: 100px; height: 100px; }
}</style>
</head>
<body>

  <div id="login-view">
    
    <div class="login-banner-bg"></div>
    
    <div class="login-box" id="login-box-main">
      <h2 class="vault-header">ACCESO A LA B√ìVEDA</h2>
      
      <form id="login-form">
        <div class="input-group">
          <input type="text" id="user" class="input-field" placeholder="USUARIO" required>
        </div>
        
        <div class="input-group">
          <input type="password" id="pass" class="input-field" placeholder="CONTRASE√ëA" required>
          <span class="material-icons-round eye-icon" id="togglePassword">visibility_off</span>
        </div>
        
        <button type="submit" class="btn-login">ENTRAR</button>
      </form>
      
      <p class="forgot-password-link" onclick="mostrarRecuperacionPaso1()">¬øOlvidaste tu contrase√±a?</p>
    </div>

    <div class="login-box hidden" id="recover-step-1">
      <h2 class="verify-header">VERIFICAR IDENTIDAD</h2>
      <p class="reminder-text">Recuerda colocar tu correo y n√∫mero registrados.</p>
      
      <form id="recover-form-1" onsubmit="enviarSolicitudRecuperacion(event)">
        <div class="input-group">
          <input type="email" id="rec-correo" class="input-field" placeholder="CORREO ELECTR√ìNICO" required>
        </div>
        <div class="input-group">
          <input type="tel" id="rec-tel" class="input-field" placeholder="TEL√âFONO REGISTRADO" required>
        </div>
        <button type="submit" class="btn-login" id="btn-recover-1" style="background: #3b82f6 !important;">COMPROBAR</button>
        
        <div class="back-container" onclick="volverLogin()">
            <span class="material-icons-round">keyboard_backspace</span>
            <span>VOLVER AL INICIO</span>
        </div>
      </form>
    </div>

    <div class="login-box hidden" id="recover-step-2">
      <h2 class="success-header">NUEVA CONTRASE√ëA</h2>
      <p style="color: var(--text-gray); margin-bottom: 25px; font-size: 0.75rem; text-align: center;">Identidad confirmada. Define tu nueva clave de acceso.</p>
      
      <form id="recover-form-2" onsubmit="procesarNuevaClave(event)">
        <div class="input-group">
          <input type="password" id="rec-nueva-clave" class="input-field" placeholder="ASIGNAR NUEVA CLAVE" required>
        </div>
        <button type="submit" class="btn-login" id="btn-recover-2" style="background: #10b981 !important; color: #000 !important;">ACTUALIZAR</button>
      </form>
    </div>

  </div>

  <div id="app-view" style="display: none;">
    
    <aside class="sidebar">
      <div class="logo">
        <img src="https://drive.google.com/thumbnail?id=1VfnMFu-s6m4SQKgktjWxKuy6Nq0hGhI4&sz=w200" 
             alt="Logo Jeico" 
             class="logo-img">
        <h2>Jeico streaming</h2>
      </div>
      
      <ul class="nav-links">
        <li class="nav-item active" onclick="nav('inicio', this)">
          <span class="material-icons-round">home</span>
          <span>INICIO</span>
        </li>

        <li class="nav-item" onclick="nav('tienda', this)">
          <span class="material-icons-round">storefront</span>
          <span>TIENDA</span>
        </li>

        <li class="nav-item has-submenu" onclick="toggleSubmenu(this)">
          <div style="display:flex; align-items:center; gap:12px; width:100%;">
            <span class="material-icons-round">person</span>
            <span>MI CUENTA</span>
            <span class="material-icons-round arrow-icon" style="margin-left:auto; font-size:1.2rem;">expand_more</span>
          </div>
        </li>
        <ul class="submenu hidden" id="submenu-cuenta">
            <li class="submenu-item" onclick="nav('pedidos', this)">
                <span class="material-icons-round">receipt_long</span>
                <span>Mis Pedidos</span>
            </li>
            <li class="submenu-item" onclick="nav('billetera', this)">
                <span class="material-icons-round">account_balance_wallet</span>
                <span>Mi Billetera</span>
            </li>
            <li class="submenu-item" onclick="nav('datos', this)">
                <span class="material-icons-round">manage_accounts</span>
                <span>Mis Datos</span>
            </li>
        </ul>

        <li class="nav-item" onclick="nav('recarga', this)">
          <span class="material-icons-round">savings</span>
          <span>RECARGAR</span>
        </li>
        
        <li class="nav-item has-submenu" onclick="toggleSubmenu(this)">
          <div style="display:flex; align-items:center; gap:12px; width:100%;">
            <span class="material-icons-round">support_agent</span>
            <span>SOPORTE</span>
            <span class="material-icons-round arrow-icon" style="margin-left:auto; font-size:1.2rem;">expand_more</span>
          </div>
        </li>
        <ul class="submenu hidden" id="submenu-soporte">
            <li class="submenu-item" onclick="nav('soporte', this)">
                <span class="material-icons-round">bug_report</span>
                <span>Crear Ticket</span>
            </li>
            <li class="submenu-item" onclick="nav('mistickets', this)">
                <span class="material-icons-round">history_edu</span>
                <span>Mis Tickets</span>
            </li>
        </ul>
        
        <li class="nav-item" onclick="nav('codigos', this)">
            <span class="material-icons-round">vpn_key</span>
            <span>C√ìDIGOS</span>
        </li>
        <li class="nav-item" onclick="nav('ranking', this)">
            <span class="material-icons-round">emoji_events</span>
            <span>RANKING</span>
        </li>
        
        <li class="nav-item logout-link" onclick="logout()" style="margin-top: auto;">
          <span class="material-icons-round">logout</span>
          <span>SALIR</span>
        </li>
      </ul>
      
      <div class="user-sidebar-info">
        <div class="user-avatar-circle">
          <span class="material-icons-round">account_circle</span>
        </div>
        <div class="user-data-text">
          <span class="user-name" id="display-user">...</span>
          <div class="user-balance" id="display-balance">$ 0</div>
        </div>
      </div>
    </aside>

    <button class="hamburger-menu" id="hamburger-btn" onclick="toggleSidebar()">
      <span class="material-icons-round">menu</span>
    </button>

    <main class="main-content">
      
      <div id="sec-inicio">
        <div class="hero-container">
            <div class="hero-content">
                <h1>Entretenimiento Sin L√≠mites</h1>
                <p>Acceso exclusivo a las mejores plataformas de streaming. Sistema automatizado, garant√≠a inmediata y soporte profesional 24/7.</p>
                <button onclick="nav('tienda', document.querySelector('.nav-item[onclick*=\'tienda\']'))" class="cta-button">VER PLANES DISPONIBLES</button>
            </div>
        
            <div class="features-grid">
                <div class="feature-card">
                    <span class="feature-icon">‚ö°</span>
                    <span class="feature-title">ENTREGA INSTANT√ÅNEA</span>
                    <span class="feature-desc">Cuentas disponibles al momento de confirmar tu pedido.</span>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">üïí</span>
                    <span class="feature-title">SERVICIO 24 HORAS</span>
                    <span class="feature-desc">Nuestra plataforma opera sin interrupciones todo el a√±o.</span>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">üõ°Ô∏è</span>
                    <span class="feature-title">GARANT√çA TOTAL</span>
                    <span class="feature-desc">Tu inversi√≥n est√° protegida por nuestro soporte t√©cnico.</span>
                </div>
            </div>
        </div>
      </div>

      <div id="sec-tienda" class="hidden">
        <div class="section-header-premium">
          <h1 class="page-title">CAT√ÅLOGO PREMIUM</h1>
          <p class="section-description">Selecciona el servicio que deseas activar en tu cuenta.</p>
        </div>
        <div id="shop-container" class="products-grid">
          <div class="spinner-container">
            <div class="spinner"></div>
          </div>
        </div>
      </div>

      <div id="sec-billetera" class="hidden">
        <h1 class="page-title">MI BILLETERA</h1>
        <div class="wallet-layout">
          <div class="wallet-card">
              <div class="wallet-label">SALDO DISPONIBLE ACTUAL</div>
              <div class="wallet-amount" id="wallet-balance-big">$ 0.00</div>
              <div class="wallet-actions">
                  <button onclick="nav('recarga')" class="btn-wallet-action">
                      <span class="material-icons-round">add_circle</span>
                      <span>SOLICITAR RECARGA</span>
                  </button>
              </div>
          </div>
          <div class="history-container-premium">
              <div class="history-header">
                <h3>MOVIMIENTOS RECIENTES</h3>
                <span class="material-icons-round" style="color: var(--accent);">history</span>
              </div>
              <div class="table-responsive-wrapper">
                <table class="premium-table">
                    <thead>
                        <tr>
                            <th>FECHA</th>
                            <th>DESCRIPCI√ìN / TIPO</th>
                            <th style="text-align:center;">MONTO (COP)</th>
                            <th style="text-align:right;">NUEVO SALDO</th>
                        </tr>
                    </thead>
                    <tbody id="wallet-history">
                        <tr><td colspan="4" style="text-align:center; padding: 60px; color:#555;">Sincronizando movimientos...</td></tr>
                    </tbody>
                </table>
              </div>
          </div>
        </div>
      </div>

      <div id="sec-pedidos" class="hidden">
        <div class="page-header-premium">
            <h1 class="page-title">MIS ADQUISICIONES</h1>
            <p class="page-subtitle">Acceso directo a tus credenciales y b√≥veda personal.</p>
        </div>

        <div class="search-premium-container">
            <span class="material-icons-round search-icon">search</span>
            <input type="text" id="input-busqueda-pedidos" placeholder="Buscar servicio o usuario..." onkeydown="if(event.key === 'Enter') ejecutarBusquedaPedidos()">
            <button class="btn-search-action" onclick="ejecutarBusquedaPedidos()">BUSCAR</button>
        </div>

        <div id="orders-container" class="orders-premium-grid">
            <div style="grid-column: 1/-1; text-align:center; padding:60px;">
                <div class="spinner"></div>
                <p style="color:var(--text-gray); margin-top:20px; letter-spacing:2px; font-size:0.8rem;">AUTENTICANDO ACCESO...</p>
            </div>
        </div>
      </div>

      <div id="sec-recarga" class="hidden">
        <div style="text-align:center; padding:100px;">
            <div class="spinner"></div>
            <p style="color:var(--text-gray); margin-top:20px; letter-spacing:2px;">PREPARANDO PASARELA...</p>
        </div>
      </div>

      <div id="sec-soporte" class="hidden">
        <h1 class="page-title">CENTRO DE AYUDA</h1>
        <div class="support-card-premium">
          <div class="support-header">
            <span class="material-icons-round" style="font-size: 3.5rem; color: var(--accent);">gpp_maybe</span>
            <h3>SOPORTE T√âCNICO</h3>
          </div>
          <p>¬øProblemas con el acceso? Reporta fallos en cuentas, perfiles o renovaciones. Estamos para servirte.</p>
          <div class="support-info-grid">
            <div class="info-item">
              <strong>DISPONIBILIDAD</strong>
              <span>9:00 AM a 11:00 PM</span>
            </div>
            <div class="info-item">
              <strong>GARANT√çA</strong>
              <span>Protecci√≥n total 30 d√≠as</span>
            </div>
          </div>
          <a href="https://wa.me/573016149753?text=Hola,%20tengo%20un%20problema%20con%20mi%20cuenta" target="_blank" class="cta-button" style="width: 100%; margin-top: 25px;">REPORTAR FALLA AHORA</a>
        </div>
      </div>

      <div id="sec-mistickets" class="hidden">
        <div class="page-header-premium">
            <h1 class="page-title">HISTORIAL DE SOPORTE</h1>
            <p class="page-subtitle">Seguimiento y estado de tus reportes de incidencias.</p>
        </div>
        <div id="tickets-container" class="orders-premium-grid">
            <div style="grid-column: 1/-1; text-align:center; padding:60px;">
                <div class="spinner"></div>
                <p style="color:var(--text-gray); margin-top:20px; letter-spacing:2px; font-size:0.8rem;">CARGANDO TICKETS...</p>
            </div>
        </div>
      </div>

      <div id="sec-codigos" class="hidden"></div>
      <div id="sec-datos" class="hidden"></div>
      <div id="sec-ranking" class="hidden">
        <div class="page-header-premium">
            <h1 class="page-title">SAL√ìN DE LA FAMA</h1>
            <p class="page-subtitle">Descubre a los mayores l√≠deres de la b√≥veda.</p>
        </div>
        </div>

    </main>

    <button class="floating-cart-btn hidden" id="main-cart-btn" onclick="toggleCart()">
      <span class="material-icons-round" style="font-size: 32px;">shopping_cart</span>
      <div class="cart-badge" id="cart-count">0</div>
    </button>

    <div class="overlay hidden" id="cart-overlay" onclick="toggleCart()"></div>
    
    <div class="cart-drawer" id="cart-drawer">
      <div class="drawer-header">
        <h2>MI CARRITO</h2>
        <button class="btn-close-drawer" onclick="toggleCart()">
            <span class="material-icons-round">close</span>
        </button>
      </div>
      <div class="drawer-body" id="cart-items-list">
        <p style="text-align:center; color:#444; margin-top:30px;">Tu carrito est√° esperando.</p>
      </div>
      <div class="drawer-footer">
        <div class="drawer-total">
            <span>TOTAL ESTIMADO:</span>
            <span id="cart-total-display">$ 0</span>
        </div>
        <button class="btn-checkout" onclick="goToCheckout()">PAGAR CON MI SALDO</button>
        <button class="btn-continue" onclick="toggleCart()">CONTINUAR COMPRANDO</button>
      </div>
    </div>

    <div class="overlay hidden" id="checkout-overlay"></div>
    <div class="checkout-modal" id="checkout-modal">
        <div class="checkout-header">CONFIRMACI√ìN DE PAGO</div>
        <div class="checkout-body">
            <p style="color:#777; margin-bottom:20px; font-size: 0.85rem; text-align: center;">Est√°s a un paso de activar tus servicios. Revisa tu pedido:</p>
            <div id="checkout-summary-list" class="checkout-list-container"></div>
            <div class="checkout-total-row">
                <span>D√âBITO TOTAL:</span>
                <span id="checkout-final-total">$ 0</span>
            </div>
        </div>
        <div class="checkout-actions">
            <button class="btn-final-cancel" onclick="closeCheckout()">ATR√ÅS</button>
            <button class="btn-final-pay" onclick="finalizePurchase()">CONFIRMAR Y PAGAR</button>
        </div>
    </div>

  </div>


<script id="script-script.js">
/* script.js */
// ============================================
// ‚ö†Ô∏è URL DE TU API GOOGLE APPS SCRIPT (NUEVA VERSI√ìN OPTIMIZADA) ‚ö†Ô∏è
const API_URL = "https://script.google.com/macros/s/AKfycbz_jYWSOwRctLgZEeD5kcylo-EGNnX4BCVpuH8UoD77n5VBC1x8mZ-scUSFUx6BlyA3qA/exec";
// ============================================

// --- ESTADO GLOBAL ---
let cart = []; 
let userBalance = 0;

// --- API FETCH ---
async function apiCall(params) {
  const url = new URL(API_URL);
  Object.keys(params).forEach(key => url.searchParams.append(key, params[key]));
  try { 
    const response = await fetch(url);
    return await response.json(); 
  } catch (e) { 
    console.error("Error API:", e);
    return { success: false, msg: "Error de conexi√≥n con el servidor" }; 
  }
}

// --- INICIO / COMPROBACI√ìN DE SESI√ìN ---
document.addEventListener('DOMContentLoaded', () => {
  const t = localStorage.getItem('jeico_token');
  const u = localStorage.getItem('jeico_user');
  
  if(t && u) {
    mostrarApp(u);
  } else {
    document.getElementById('login-view').style.display = 'flex';
    document.getElementById('app-view').style.display = 'none';
  }

  // --- CERRAR MEN√ö HAMBURGUESA AL HACER CLIC FUERA ---
  document.addEventListener('click', (e) => {
    const sidebar = document.querySelector('.sidebar');
    const btn = document.getElementById('hamburger-btn');
    
    // Si el men√∫ est√° abierto en m√≥vil y el clic no es en el men√∫ ni en el bot√≥n de abrir
    if (window.innerWidth <= 768 && 
        sidebar && sidebar.classList.contains('open') && 
        !sidebar.contains(e.target) && 
        !btn.contains(e.target)) {
      sidebar.classList.remove('open');
    }
  });
});

// --- L√ìGICA DE LOGIN ---
document.getElementById('login-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const u = document.getElementById('user').value;
  const p = document.getElementById('pass').value;
  const btn = document.querySelector('.btn-login'); 
  
  btn.innerText = "VERIFICANDO...";
  btn.disabled = true;
  
  const res = await apiCall({ accion: 'login', usuario: u, clave: p });
  
  btn.innerText = "ENTRAR";
  btn.disabled = false;
  
  if(res.success) {
    localStorage.setItem('jeico_token', res.token);
    localStorage.setItem('jeico_user', res.usuario);
    localStorage.setItem('jeico_saldo', res.saldo); // GUARDAR SALDO INICIAL EN CACH√â
    mostrarApp(res.usuario, res.saldo);
  } else {
    Swal.fire({
        title: 'Error',
        text: res.msg,
        icon: 'error',
        background: '#0a0a0a',
        color: '#fff',
        confirmButtonColor: '#7c3aed'
    });
  }
});

function mostrarApp(user, saldo) {
  document.getElementById('login-view').style.display = 'none';
  document.getElementById('app-view').style.display = 'block';
  document.getElementById('display-user').innerText = user;
  
  // L√ìGICA DE CACH√â DE SALDO
  if(saldo !== undefined) {
    userBalance = Number(saldo);
    localStorage.setItem('jeico_saldo', userBalance);
  } else {
    // Si carga desde cach√© (al recargar la p√°gina), muestra r√°pido y luego sincroniza en silencio
    userBalance = Number(localStorage.getItem('jeico_saldo')) || 0;
    sincronizarSaldo(); 
  }
  
  updateBalanceUI();
  
  // Siempre iniciar en la secci√≥n de INICIO por defecto
  nav('inicio', document.querySelector('.nav-item[onclick*="inicio"]'));
}

async function sincronizarSaldo() {
    const u = localStorage.getItem('jeico_user');
    const t = localStorage.getItem('jeico_token');
    if (!u || !t) return;

    try {
        const res = await apiCall({ accion: 'getSaldo', usuario: u, token: t });
        if (res.success) {
            // Si el saldo en la DB es distinto al local, actualiza la UI al instante
            if (Number(res.saldo) !== userBalance) {
                userBalance = Number(res.saldo);
                localStorage.setItem('jeico_saldo', userBalance);
                updateBalanceUI();
            }
        } else if (res.msg === "Sesi√≥n inv√°lida") {
            // Si le cambiaron la clave en la base de datos o el token expir√≥, lo saca
            logout();
        }
    } catch (e) {
        console.error("Falla en sincronizaci√≥n de fondo.");
    }
}

function updateBalanceUI() {
    const formatted = `$ ${new Intl.NumberFormat('es-CO').format(userBalance)}`;
    document.getElementById('display-balance').innerText = formatted;
    
    const bigWallet = document.getElementById('wallet-balance-big');
    if(bigWallet) bigWallet.innerText = formatted;
}

// --- TOGGLE DEL SIDEBAR ---
function toggleSidebar() {
    const sidebar = document.querySelector('.sidebar');
    if(sidebar) sidebar.classList.toggle('open');
}

// --- L√ìGICA DE NAVEGACI√ìN ---
/**
 * Navegaci√≥n principal de la App Jeico Streaming
 */
function nav(sec, el) {
    // 1. MANEJO DE CLASES ACTIVAS EN EL MEN√ö
    if (el && !el.classList.contains('submenu-item')) {
        document.querySelectorAll('.nav-links > .nav-item').forEach(e => e.classList.remove('active'));
        el.classList.add('active');
    }
    
    // 2. OCULTAR TODAS LAS SECCIONES
    const secciones = ['inicio', 'tienda', 'pedidos', 'recarga', 'soporte', 'billetera', 'codigos', 'datos', 'mistickets', 'ranking'];
    secciones.forEach(id => {
        const elem = document.getElementById('sec-' + id);
        if(elem) elem.classList.add('hidden');
    });
    
    // 3. MOSTRAR LA SECCI√ìN SELECCIONADA
    const section = document.getElementById('sec-' + sec);
    if(section) {
        section.classList.remove('hidden');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // --- CERRAR SIDEBAR TRAS NAVEGAR (M√ìVIL) ---
    if (window.innerWidth <= 768) {
        const sidebar = document.querySelector('.sidebar');
        if(sidebar) sidebar.classList.remove('open');
    }

    // 4. CONTROL DE VISIBILIDAD DEL CARRITO
    const cartBtn = document.getElementById('main-cart-btn');
    const cartDrawer = document.getElementById('cart-drawer');
    const cartOverlay = document.getElementById('cart-overlay');

    if (sec === 'tienda') {
        if(cartBtn) cartBtn.classList.remove('hidden');
        cargarTienda(); 
    } else {
        if(cartBtn) cartBtn.classList.add('hidden');
        if(cartDrawer) cartDrawer.classList.remove('open');
        if(cartOverlay) cartOverlay.classList.add('hidden');
    }
    
    // 5. INICIALIZACI√ìN DE M√ìDULOS ESPEC√çFICOS
    if (sec === 'pedidos') if(typeof cargarPedidos === 'function') cargarPedidos();
    if (sec === 'billetera') if(typeof cargarBilletera === 'function') cargarBilletera();
    if (sec === 'recarga') if(typeof cargarRecarga === 'function') cargarRecarga();
    if (sec === 'soporte') if(typeof cargarSoporte === 'function') cargarSoporte(); 
    if (sec === 'codigos') if(typeof cargarCodigos === 'function') cargarCodigos(); 
    if (sec === 'datos') if(typeof cargarDatos === 'function') cargarDatos(); 
    if (sec === 'mistickets') if(typeof cargarMisTickets === 'function') cargarMisTickets();
    if (sec === 'ranking') if(typeof cargarRanking === 'function') cargarRanking();
}

// --- L√ìGICA DE TIENDA Y STOCK ---
async function cargarTienda() {
  const u = localStorage.getItem('jeico_user');
  const t = localStorage.getItem('jeico_token');
  const container = document.getElementById('shop-container');
  
  container.innerHTML = '<div class="spinner"></div>';
  
  const res = await apiCall({ accion: 'getTienda', usuario: u, token: t });
  
  if(!res.success) { 
    logout(); 
    return; 
  }
  
  userBalance = Number(res.saldo); 
  updateBalanceUI();
  container.innerHTML = "";

  if(!res.productos || res.productos.length === 0) {
    container.innerHTML = "<p style='grid-column: 1/-1; text-align:center; color:#555;'>No hay productos configurados.</p>";
    return;
  }

  res.productos.forEach(p => {
    let img = p.img;
    if(img && img.includes('drive')) {
        const id = img.match(/\/d\/([a-zA-Z0-9_-]+)/) || img.match(/id=([a-zA-Z0-9_-]+)/);
        if(id) img = `https://drive.google.com/thumbnail?id=${id[1]}&sz=w400`;
    }

    const isSoldOut = p.stock <= 0;
    const soldOutClass = isSoldOut ? 'sold-out' : '';
    const btnHtml = isSoldOut 
        ? `<button class="btn-buy disabled" disabled>AGOTADO</button>`
        : `<button class="btn-buy" onclick="addToCart('${p.nombre}', ${p.precio}, '${img}')">AGREGAR</button>`;
    
    const stockHtml = isSoldOut 
        ? `<span style="color:#9f1239; font-weight:bold;">SIN STOCK</span>` 
        : `${p.stock} disponibles`;

    const card = document.createElement('div');
    card.className = `product-card ${soldOutClass}`;
    card.innerHTML = `
      <div class="card-img-container"><img src="${img || ''}" class="card-img" alt="${p.nombre}"></div>
      <div class="card-body">
        <div class="card-title">${p.nombre}</div>
        <div class="price-container">
            <span class="card-price">$ ${new Intl.NumberFormat('es-CO').format(p.precio)}</span>
        </div>
        <div class="card-stock">${stockHtml}</div>
        ${btnHtml}
      </div>
    `;
    container.appendChild(card);
  });
}

// --- L√ìGICA DE CARRITO ---
function addToCart(nombre, precio, img) {
    const existe = cart.find(item => item.nombre === nombre);
    if(existe) {
        existe.cantidad++;
    } else {
        cart.push({ nombre, precio, img, cantidad: 1 });
    }
    updateCartUI();
    
    const Toast = Swal.mixin({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 1500,
        background: '#0a0a0a',
        color: '#fff',
        iconColor: '#7c3aed'
    });
    Toast.fire({ icon: 'success', title: 'A√±adido al carrito' });
}

function updateCartUI() {
    const list = document.getElementById('cart-items-list');
    const badge = document.getElementById('cart-count');
    const totalDisplay = document.getElementById('cart-total-display');
    
    list.innerHTML = "";
    let total = 0;
    let count = 0;

    if(cart.length === 0) {
        list.innerHTML = '<p style="text-align:center; color:#555; margin-top:20px;">Tu carrito est√° vac√≠o.</p>';
    } else {
        cart.forEach((item, index) => {
            total += item.precio * item.cantidad;
            count += item.cantidad;
            
            list.innerHTML += `
                <div class="cart-item-row">
                    <img src="${item.img}" class="cart-item-img">
                    <div class="cart-item-info" style="flex-grow:1;">
                        <h4>${item.nombre}</h4>
                        <div class="cart-item-price">$ ${new Intl.NumberFormat('es-CO').format(item.precio)}</div>
                        <span>Cantidad: ${item.cantidad}</span>
                    </div>
                    <button class="btn-remove" onclick="removeFromCart(${index})">
                        <span class="material-icons-round" style="font-size:1.2rem;">delete</span>
                    </button>
                </div>
            `;
        });
    }

    badge.innerText = count;
    totalDisplay.innerText = `$ ${new Intl.NumberFormat('es-CO').format(total)}`;
}

function removeFromCart(index) {
    cart.splice(index, 1);
    updateCartUI();
}

function toggleCart() {
    const drawer = document.getElementById('cart-drawer');
    const overlay = document.getElementById('cart-overlay');
    drawer.classList.toggle('open');
    overlay.classList.toggle('hidden');
}

// --- CHECKOUT & COMPRA ---
function goToCheckout() {
    if(cart.length === 0) return;
    
    let total = cart.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
    const summaryList = document.getElementById('checkout-summary-list');
    summaryList.innerHTML = "";
    
    cart.forEach(item => {
        summaryList.innerHTML += `
            <div class="checkout-summary-row">
                <span>${item.nombre} (x${item.cantidad})</span>
                <span style="color:var(--accent); font-weight:bold;">$ ${new Intl.NumberFormat('es-CO').format(item.precio * item.cantidad)}</span>
            </div>
        `;
    });

    document.getElementById('checkout-final-total').innerText = `$ ${new Intl.NumberFormat('es-CO').format(total)}`;

    toggleCart(); 
    document.getElementById('checkout-overlay').classList.remove('hidden');
    document.getElementById('checkout-modal').classList.add('active');
}

function closeCheckout() {
    document.getElementById('checkout-overlay').classList.add('hidden');
    document.getElementById('checkout-modal').classList.remove('active');
}

async function finalizePurchase() {
    let total = cart.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
    
    if(userBalance < total) {
        return Swal.fire({
            title: 'Saldo Insuficiente',
            text: 'No tienes saldo suficiente para esta compra.',
            icon: 'error',
            background: '#0a0a0a', color: '#fff'
        });
    }

    const u = localStorage.getItem('jeico_user');
    const t = localStorage.getItem('jeico_token');
    
    // Mostramos alerta de progreso
    Swal.fire({ 
        title: 'PROCESANDO PAGO', 
        text: 'Iniciando conexi√≥n segura...',
        didOpen: () => Swal.showLoading(), 
        background: '#0a0a0a', color:'#fff',
        allowOutsideClick: false
    });

    let errores = [];
    let exitos = 0;

    for (const item of cart) {
        for(let i=0; i<item.cantidad; i++) {
            // Actualizar texto del progreso visualmente
            Swal.update({
                text: `Comprando: ${item.nombre} (Unidad ${i + 1} de ${item.cantidad})...`
            });

            const res = await apiCall({ accion: 'comprar', usuario: u, token: t, producto: item.nombre });
            if(res.success) {
                exitos++;
                userBalance = res.nuevoSaldo; 
                // GUARDAMOS EL NUEVO SALDO EN CACH√â AL INSTANTE
                localStorage.setItem('jeico_saldo', userBalance); 
            } else {
                errores.push(`${item.nombre}: ${res.msg}`);
            }
        }
    }

    closeCheckout();
    updateBalanceUI();
    
    if(exitos > 0) {
        cart = []; 
        updateCartUI();
        cargarTienda(); 
        
        if(errores.length > 0) {
            Swal.fire({
                title: 'Compra Parcial',
                text: `Se procesaron ${exitos} cuentas. Fallaron: ${errores.length}`,
                icon: 'warning',
                background: '#0a0a0a', color: '#fff'
            });
        } else {
            Swal.fire({
                title: '¬°PAGO COMPLETADO!',
                text: 'Revisa tus cuentas en la secci√≥n "Mis Pedidos"',
                icon: 'success',
                background: '#0a0a0a', color:'#fff',
                confirmButtonColor: '#7c3aed'
            });
        }
    } else {
        Swal.fire({
            title: 'Error en la compra',
            text: errores[0] || "No se pudo procesar la solicitud.",
            icon: 'error',
            background: '#0a0a0a', color: '#fff'
        });
    }
}

// --- OTROS M√âTODOS ---
/**
 * Alternar Men√∫s Desplegables (Din√°mico para m√∫ltiples men√∫s)
 */
function toggleSubmenu(elemento) {
    // Busca el elemento que est√° exactamente debajo del bot√≥n clickeado en el HTML
    const submenu = elemento.nextElementSibling;
    
    // Verifica que el elemento de abajo sea realmente un submen√∫
    if (submenu && submenu.classList.contains('submenu')) {
        // Muestra u oculta el submen√∫
        submenu.classList.toggle('hidden');
        
        // Gira la flechita (a√±ade la clase 'open' al li)
        elemento.classList.toggle('open');
    }
}

function cargarBilletera() {
    updateBalanceUI();
}

async function cargarPedidos() {
    const u = localStorage.getItem('jeico_user');
    const t = localStorage.getItem('jeico_token');
    const tbody = document.getElementById('orders-tbody');
    
    if(!tbody) return;
    tbody.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:40px;"><div class="spinner"></div></td></tr>';
    
    const res = await apiCall({ accion: 'getPedidos', usuario: u, token: t });
    tbody.innerHTML = "";
    
    if(res.success && res.datos && res.datos.length > 0) {
        res.datos.forEach(p => {
            const fechaVal = p.fecha ? new Date(p.fecha).toLocaleDateString() : 'N/A';
            tbody.innerHTML += `
            <tr style="border-bottom:1px solid #1a1a1a;">
                <td style="padding:20px; color:#fff; font-weight:bold;">${p.servicio}</td>
                <td style="padding:20px;">
                    <div style="background:#000; padding:10px; border:1px solid #222; font-family:monospace; color:var(--accent);">
                        USER: ${p.cuenta}<br>PASS: ${p.clave}
                    </div>
                </td>
                <td style="padding:20px; color:#555;">${fechaVal}</td>
            </tr>`;
        });
    } else {
        tbody.innerHTML = "<tr><td colspan='3' style='text-align:center; padding:40px; color:#444;'>No has realizado compras todav√≠a.</td></tr>";
    }
}
// L√≥gica para mostrar/ocultar contrase√±a
document.addEventListener('DOMContentLoaded', () => {
    const togglePassword = document.querySelector('#togglePassword');
    const passwordField = document.querySelector('#pass');

    if (togglePassword && passwordField) {
        togglePassword.addEventListener('click', function () {
            // Cambiamos el tipo de input
            const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordField.setAttribute('type', type);
            
            // Cambiamos el icono
            this.textContent = type === 'password' ? 'visibility_off' : 'visibility';
            
            // Un peque√±o efecto de feedback
            this.style.transform = 'scale(1.2)';
            setTimeout(() => this.style.transform = 'scale(1)', 150);
        });
    }
});
function logout() {
    // Borramos solo la sesi√≥n, pero dejamos la cach√© de datos intacta
    localStorage.removeItem('jeico_token');
    localStorage.removeItem('jeico_user');
    
    // Recargamos la p√°gina para volver a la pantalla de Login
    location.reload();
}</script>
<script id="script-Tienda.js">
    /* Tienda.js */
/**
 * ===============================================================
 * TIENDA.JS - VERSI√ìN DEFINITIVA ULTRA-PREMIUM (SINCRONIZADA)
 * ===============================================================
 */

const STORE_CACHE_KEY = "jeico_store_cache";

// --- CONFIGURACI√ìN DE NOTIFICACIONES (CON FIX DE Z-INDEX) ---
const Toast = Swal.mixin({
    toast: true,
    position: 'top-end',
    showConfirmButton: false,
    timer: 2500,
    background: '#0a0a0a',
    color: '#fff',
    iconColor: '#7c3aed',
    // Forzamos que el contenedor de la alerta est√© por encima de todo (z-index)
    customClass: {
        container: 'swal-high-priority'
    }
});

/**
 * 1. CARGA INICIAL Y SINCRONIZACI√ìN
 */
async function cargarTienda() {
    const container = document.getElementById('shop-container');
    
    // A. Carga instant√°nea desde memoria (Cach√© local)
    const cachedData = localStorage.getItem(STORE_CACHE_KEY);
    if (cachedData) {
        const data = JSON.parse(cachedData);
        renderizarTiendaPremium(data.productos, true);
    } else {
        container.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:50px;"><div class="spinner"></div></div>';
    }

    // B. Sincronizaci√≥n real de fondo con el servidor
    const u = localStorage.getItem('jeico_user');
    const t = localStorage.getItem('jeico_token');

    try {
        const res = await apiCall({ accion: 'getTienda', usuario: u, token: t });

        if (res.success) {
            userBalance = Number(res.saldo);
            if (typeof updateBalanceUI === 'function') updateBalanceUI();

            // Actualizamos la cach√© con los datos m√°s frescos
            localStorage.setItem(STORE_CACHE_KEY, JSON.stringify({
                productos: res.productos,
                timestamp: new Date().getTime()
            }));

            // Re-renderizamos silenciosamente sin interrumpir al usuario
            renderizarTiendaPremium(res.productos, false);
        } else {
            if (res.msg === "Sesi√≥n inv√°lida") logout();
        }
    } catch (e) {
        console.error("Error de sincronizaci√≥n de tienda:", e);
    }
}

/**
 * 2. RENDERIZADOR DE TARJETAS (RECTANGULARES Y AGOTADOS)
 */
function renderizarTiendaPremium(productos, isCache) {
    const container = document.getElementById('shop-container');
    container.innerHTML = "";

    if (!productos || productos.length === 0) {
        container.innerHTML = "<p style='grid-column: 1/-1; text-align:center; color:#444; padding:50px;'>Cat√°logo vac√≠o actualmente.</p>";
        return;
    }

    productos.forEach(p => {
        let img = p.img;
        if (img && img.includes('drive')) {
            const id = img.match(/\/d\/([a-zA-Z0-9_-]+)/) || img.match(/id=([a-zA-Z0-9_-]+)/);
            if (id) img = `https://drive.google.com/thumbnail?id=${id[1]}&sz=w600`;
        }

        const stockActual = Number(p.stock) || 0;
        const isSoldOut = stockActual <= 0;
        const precioActual = Number(p.precio) || 0;
        const precioAnterior = Number(p.precioAnt) || 0;
        const tieneOferta = precioAnterior > precioActual;

        // Bot√≥n con validaci√≥n visual si est√° cargando desde cach√©
        let btnHtml = isCache 
            ? `<button class="btn-buy" style="opacity:0.5; cursor:wait;">SINCRONIZANDO...</button>`
            : isSoldOut 
                ? `<button class="btn-buy disabled" disabled>AGOTADO</button>`
                : `<button class="btn-buy" onclick="addToCart('${p.nombre}', ${precioActual}, '${img}', ${stockActual})">AGREGAR AL CARRITO</button>`;

        const card = document.createElement('div');
        card.className = `product-card ${isSoldOut ? 'sold-out' : ''}`;
        
        card.innerHTML = `
            <div class="card-img-container">
                <img src="${img || ''}" class="card-img" alt="${p.nombre}">
                ${isSoldOut ? '<div class="sold-out-badge">AGOTADO</div>' : ''}
            </div>
            <div class="card-body">
                <div class="card-title">${p.nombre}</div>
                <div class="price-container">
                    ${tieneOferta ? `<div class="price-old-container"><span class="price-old">$ ${new Intl.NumberFormat('es-CO').format(precioAnterior)}</span><span class="offer-badge">OFERTA</span></div>` : ''}
                    <div class="card-price" ${tieneOferta ? 'style="color: #a855f7;"' : ''}>$ ${new Intl.NumberFormat('es-CO').format(precioActual)}</div>
                </div>
                <div class="card-stock">
                    ${isSoldOut ? '<span style="color:var(--danger); font-weight:800;">SIN STOCK DISPONIBLE</span>' : `Disponibles: <b>${stockActual}</b>`}
                </div>
                ${btnHtml}
            </div>
        `;
        container.appendChild(card);
    });
}

/**
 * 3. L√ìGICA DEL CARRITO (CANTIDADES Y STOCK M√ÅXIMO)
 */
function addToCart(nombre, precio, img, stockReal) {
    const existe = cart.find(item => item.nombre === nombre);
    
    if (existe) {
        if (existe.cantidad < stockReal) {
            existe.cantidad++;
            Toast.fire({ icon: 'success', title: 'Cantidad aumentada' });
        } else {
            return Toast.fire({ 
                icon: 'warning', 
                title: 'Stock limitado',
                text: `Solo quedan ${stockReal} unidades.` 
            });
        }
    } else {
        cart.push({ nombre, precio, img, cantidad: 1, stockMax: stockReal });
        Toast.fire({ icon: 'success', title: 'Producto a√±adido' });
    }
    updateCartUI();
}

function changeQty(index, delta) {
    const item = cart[index];
    const nuevaCant = item.cantidad + delta;
    
    if (nuevaCant > 0 && nuevaCant <= item.stockMax) {
        item.cantidad = nuevaCant;
    } else if (nuevaCant <= 0) {
        cart.splice(index, 1);
        Toast.fire({ icon: 'info', title: 'Producto eliminado' });
    } else {
        return Toast.fire({ icon: 'info', title: 'No hay m√°s stock' });
    }
    updateCartUI();
}

function updateCartUI() {
    const list = document.getElementById('cart-items-list');
    const badge = document.getElementById('cart-count');
    const totalDisplay = document.getElementById('cart-total-display');
    
    if(!list || !badge || !totalDisplay) return;

    list.innerHTML = "";
    let total = 0;
    let count = 0;

    if(cart.length === 0) {
        list.innerHTML = '<div style="text-align:center; color:#555; margin-top:50px;">Carrito vac√≠o</div>';
    } else {
        cart.forEach((item, index) => {
            total += item.precio * item.cantidad;
            count += item.cantidad;
            
            list.innerHTML += `
                <div class="cart-item-row-premium">
                    <img src="${item.img}" class="cart-item-img">
                    <div class="cart-item-info">
                        <h4 class="cart-item-title">${item.nombre}</h4>
                        <div class="cart-item-price">$ ${new Intl.NumberFormat('es-CO').format(item.precio)}</div>
                        <div class="qty-selector">
                            <button class="btn-qty" onclick="changeQty(${index}, -1)">-</button>
                            <span class="qty-num">${item.cantidad}</span>
                            <button class="btn-qty" onclick="changeQty(${index}, 1)">+</button>
                        </div>
                    </div>
                    <button class="btn-remove-item" onclick="removeFromCart(${index})">
                        <span class="material-icons-round">close</span>
                    </button>
                </div>
            `;
        });
    }

    badge.innerText = count;
    totalDisplay.innerText = `$ ${new Intl.NumberFormat('es-CO').format(total)}`;
}

function removeFromCart(index) {
    cart.splice(index, 1);
    updateCartUI();
}

/**
 * 4. CHECKOUT Y PAGO FINAL (CON PROGRESO EN TIEMPO REAL)
 */
function goToCheckout() {
    if(cart.length === 0) return;
    
    let total = cart.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
    const summaryList = document.getElementById('checkout-summary-list');
    summaryList.innerHTML = "";
    
    cart.forEach(item => {
        summaryList.innerHTML += `
            <div class="checkout-item-premium">
                <div>
                    <div class="checkout-item-name">${item.nombre}</div>
                    <div class="checkout-item-qty">Unidades: ${item.cantidad}</div>
                </div>
                <div class="checkout-item-price">$ ${new Intl.NumberFormat('es-CO').format(item.precio * item.cantidad)}</div>
            </div>
        `;
    });

    document.getElementById('checkout-final-total').innerText = `$ ${new Intl.NumberFormat('es-CO').format(total)}`;
    
    if(typeof toggleCart === 'function') toggleCart(); 
    document.getElementById('checkout-overlay').classList.remove('hidden');
    document.getElementById('checkout-modal').classList.add('active');
}

function closeCheckout() {
    document.getElementById('checkout-overlay').classList.add('hidden');
    document.getElementById('checkout-modal').classList.remove('active');
}

async function finalizePurchase() {
    let total = cart.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
    if(userBalance < total) return Toast.fire({ icon: 'error', title: 'Saldo insuficiente' });

    // 1. CERRAR MODAL DE CONFIRMACI√ìN INMEDIATAMENTE
    closeCheckout();

    const u = localStorage.getItem('jeico_user');
    const t = localStorage.getItem('jeico_token');
    
    // 2. LANZAR CARGADOR CON PRIORIDAD ABSOLUTA
    Swal.fire({ 
        title: 'PROCESANDO TRANSACCI√ìN', 
        text: 'Iniciando conexi√≥n segura...',
        didOpen: () => Swal.showLoading(), 
        background: '#0a0a0a', 
        color: '#fff',
        allowOutsideClick: false,
        customClass: { container: 'swal-top-layer' }
    });

    let errores = [], exitos = 0;
    
    // 3. PROCESAR COMPRAS CON FEEDBACK VISUAL ITEM POR ITEM
    for (const item of cart) {
        for(let i=0; i<item.cantidad; i++) {
            
            Swal.update({
                text: `Activando: ${item.nombre} (Unidad ${i + 1} de ${item.cantidad})...`
            });

            const res = await apiCall({ accion: 'comprar', usuario: u, token: t, producto: item.nombre });
            
            if(res.success) { 
                exitos++; 
                userBalance = res.nuevoSaldo; 
                localStorage.setItem('jeico_saldo', userBalance);
            } else { 
                errores.push(`${item.nombre}: ${res.msg}`); 
            }
        }
    }

    if(typeof updateBalanceUI === 'function') updateBalanceUI();
    
    // 4. RESULTADO FINAL
    if(exitos > 0) {
        cart = []; 
        updateCartUI();
        cargarTienda(); // Recarga la tienda para actualizar el stock real
        
        if (errores.length > 0) {
             Swal.fire({
                title: 'Compra Parcial',
                text: `Se activaron ${exitos} servicios. Fallaron: ${errores.length}`,
                icon: 'warning',
                background: '#0a0a0a', color: '#fff',
                customClass: { container: 'swal-top-layer' }
            });
        } else {
            Swal.fire({
                icon: 'success',
                title: '¬°PAGO REALIZADO!',
                text: `Se activaron ${exitos} servicios correctamente. Rev√≠salos en Mis Pedidos.`,
                background: '#0a0a0a', color: '#fff',
                confirmButtonColor: '#7c3aed',
                customClass: { container: 'swal-top-layer' }
            });
        }
    } else {
        Swal.fire({ 
            icon: 'error', 
            title: 'Transacci√≥n fallida', 
            text: errores[0] || "Error desconocido",
            background: '#0a0a0a', color: '#fff',
            customClass: { container: 'swal-top-layer' }
        });
    }
}

/**
 * 5. ESTILOS INTEGRADOS (RECTANGULAR + Z-INDEX + FIX HAMBURGUESA Y CARRITO)
 */
const tiendaStyles = `
    .product-card { height: 480px; display: flex; flex-direction: column; overflow: hidden; }
    .card-img-container { height: 50%; width: 100%; position: relative; background: #111; overflow: hidden; }
    .card-img { width: 100%; height: 100%; object-fit: cover; border-radius: 0; transition: transform 0.5s; }
    .product-card:hover .card-img { transform: scale(1.05); }
    .card-body { height: 50%; padding: 20px; display: flex; flex-direction: column; justify-content: space-between; background: linear-gradient(180deg, #0a0a0a 0%, #000000 100%); }
    .price-old-container { display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: -5px; }
    .price-old { text-decoration: line-through; color: #555; font-size: 0.8rem; }
    .offer-badge { background: var(--accent); color: white; font-size: 0.6rem; font-weight: 900; padding: 2px 6px; border-radius: 2px; }
    .sold-out-badge { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg); background: var(--danger); color: white; padding: 8px 15px; font-weight: 900; border: 2px solid white; z-index: 10; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
    .product-card.sold-out { filter: grayscale(0.8); opacity: 0.7; }
    .btn-buy.disabled { border-color: #333; color: #555; background: #111; cursor: not-allowed; }

    /* CARRITO DRAWER PREMIUM */
    .cart-item-row-premium { display: flex; align-items: center; gap: 15px; padding: 15px 0; border-bottom: 1px solid #111; }
    .cart-item-img { width: 60px; height: 60px; object-fit: cover; border-radius: 4px; border: 1px solid #222; }
    .cart-item-info { flex-grow: 1; }
    .cart-item-title { color: #fff; font-size: 0.85rem; font-weight: 600; margin-bottom: 5px; }
    .cart-item-price { color: var(--accent); font-weight: 700; font-size: 0.85rem; }
    .qty-selector { display: flex; align-items: center; gap: 10px; margin-top: 8px; background: #000; width: fit-content; padding: 2px 8px; border-radius: 4px; border: 1px solid #1a1a1a; }
    .btn-qty { background: none; border: none; color: var(--accent); font-size: 1.1rem; font-weight: 800; cursor: pointer; }
    .qty-num { color: #fff; font-size: 0.85rem; min-width: 15px; text-align: center; }
    .btn-remove-item { background: none; border: none; color: #444; cursor: pointer; transition: 0.3s; }
    .btn-remove-item:hover { color: var(--danger); }

    /* CHECKOUT */
    .checkout-item-premium { display: flex; justify-content: space-between; align-items: center; background: #050505; padding: 12px 15px; margin-bottom: 8px; border-radius: 6px; border-left: 3px solid var(--accent); }
    .checkout-item-name { color: #fff; font-size: 0.85rem; font-weight: 700; text-transform: uppercase; }
    .checkout-item-qty { color: #555; font-size: 0.7rem; }
    .checkout-item-price { color: var(--accent); font-weight: 800; }

    /* FIX Z-INDEX TOASTS Y MODALES */
    .swal-high-priority { z-index: 99999 !important; }
    .swal2-container { z-index: 1000000 !important; }
    .swal-top-layer { z-index: 1000000 !important; }

    /* =========================================================
       FIX DEFINITIVO DE BUGS M√ìVILES (INYECCI√ìN DIRECTA) 
       ========================================================= */
    @media (max-width: 768px) {
        /* Obliga al men√∫ hamburguesa a mostrar las opciones anulando tu viejo CSS */
        .sidebar .nav-links { display: block !important; }
    }
    
    /* Obliga al bot√≥n flotante a desaparecer si tiene la clase hidden */
    .floating-cart-btn.hidden { display: none !important; }
    
    /* Obliga al men√∫ del carrito lateral a esconderse fuera de la pantalla si no est√° abierto */
    .cart-drawer:not(.open) { right: -150% !important; display: none !important; }
`;

const styleSheetTienda = document.createElement("style");
styleSheetTienda.innerText = tiendaStyles;
document.head.appendChild(styleSheetTienda);
</script>
<script id="script-pedidos.js">/* pedidos.js */
/**
 * ===============================================================
 * PEDIDO.JS - VERSI√ìN ULTRA PREMIUM (PAGINACI√ìN + BUSCADOR)
 * ===============================================================
 */

const STORE_CACHE_KEY_REF = "jeico_store_cache"; 
let paginaActualPedidos = 1; 
let filtroActualPedidos = ""; // Variable global para guardar la b√∫squeda

/**
 * L√ìGICA DE B√öSQUEDA
 */
function ejecutarBusquedaPedidos() {
    const input = document.getElementById('input-busqueda-pedidos');
    if (!input) return;
    
    filtroActualPedidos = input.value.trim();
    // Al buscar algo nuevo, siempre volvemos a la p√°gina 1
    cargarPedidos(1);
}

/**
 * 1. FUNCI√ìN PRINCIPAL DE CARGA
 */
async function cargarPedidos(paginaPedida = 1) {
    const targetPage = parseInt(paginaPedida) || 1;
    paginaActualPedidos = targetPage;
    const container = document.getElementById('orders-container');
    
    if (targetPage > 1 || document.querySelector('.pagination-premium-container')) {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    // El cach√© ahora es √∫nico por p√°gina Y por t√©rmino de b√∫squeda (encriptado en base64 para evitar errores de caracteres)
    const cacheKeyPagina = `jeico_orders_cache_p${targetPage}_q_${btoa(filtroActualPedidos)}`;
    let cachedOrdersStr = localStorage.getItem(cacheKeyPagina);
    
    if (cachedOrdersStr) {
        try {
            renderizarPedidosPremium(JSON.parse(cachedOrdersStr));
        } catch (e) { console.error("Error leyendo cach√©:", e); }
    } else {
        const textoCarga = filtroActualPedidos !== "" ? `BUSCANDO "${filtroActualPedidos.toUpperCase()}"...` : `CONSULTANDO P√ÅGINA ${targetPage}...`;
        container.innerHTML = `
            <div style="grid-column: 1/-1; text-align:center; padding:80px;">
                <div class="spinner"></div>
                <p style="color:var(--text-gray); margin-top:20px; letter-spacing:3px; font-size:0.8rem; text-transform:uppercase; font-weight:800;">
                    ${textoCarga}
                </p>
            </div>`;
    }

    const u = localStorage.getItem('jeico_user');
    const t = localStorage.getItem('jeico_token');

    try {
        const res = await apiCall({ 
            accion: 'getPedidos', 
            usuario: u, 
            token: t, 
            pagina: String(targetPage),
            filtro: filtroActualPedidos 
        });

        if (res.success && res.datos) {
            const newOrdersStr = JSON.stringify(res);
            if (cachedOrdersStr !== newOrdersStr) {
                localStorage.setItem(cacheKeyPagina, newOrdersStr);
                renderizarPedidosPremium(res);
            }
        } else if (res.msg === "Sesi√≥n inv√°lida") {
            if (typeof logout === 'function') logout();
        }
    } catch (error) {
        console.error("Error en pedidos:", error);
    }
}

/**
 * 2. RENDERIZADOR DE TARJETAS Y PAGINACI√ìN
 */
function renderizarPedidosPremium(respuestaServidor) {
    const container = document.getElementById('orders-container');
    container.innerHTML = "";

    let pedidos = respuestaServidor.datos;
    const pagActual = parseInt(respuestaServidor.paginaActual) || 1;
    const totalPags = parseInt(respuestaServidor.totalPaginas) || 1;
    const filtroUsado = respuestaServidor.filtroUsado || "";

    if (!pedidos || pedidos.length === 0) {
        const msgVacio = filtroUsado !== "" 
            ? `No encontramos "${filtroUsado}" en tu b√≥veda.` 
            : `A√∫n no tienes compras en esta p√°gina.`;

        container.innerHTML = `
            <div class="no-orders-container">
                <span class="material-icons-round" style="font-size:4rem; color:#111; margin-bottom:20px;">history_toggle_off</span>
                <p style="color:#555; text-transform:uppercase; letter-spacing:3px; font-weight:800;">SIN RESULTADOS</p>
                <small style="color: #444; display: block; margin-top: 10px;">${msgVacio}</small>
            </div>`;
        return;
    }

    let storeProducts = [];
    try {
        const storeCache = localStorage.getItem(STORE_CACHE_KEY_REF);
        if (storeCache) storeProducts = JSON.parse(storeCache).productos || [];
    } catch (e) {}

    // ORDENAMIENTO FORZADO: Asegura que el m√°s reciente quede arriba a la izquierda
    pedidos.sort((a, b) => {
        const fechaA = a.fecha ? new Date(a.fecha).getTime() : 0;
        const fechaB = b.fecha ? new Date(b.fecha).getTime() : 0;
        return fechaB - fechaA; 
    });

    pedidos.forEach((p, index) => {
        const fechaObj = p.fecha ? new Date(p.fecha) : null;
        const fechaVal = fechaObj && !isNaN(fechaObj) ? fechaObj.toLocaleDateString('es-CO', { day: '2-digit', month: 'short', year: 'numeric' }) : 'Reciente';
        const horaVal = fechaObj && !isNaN(fechaObj) ? fechaObj.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true }) : '';

        const productMatch = storeProducts.find(prod => prod.nombre === p.servicio);
        let imgUrl = productMatch ? productMatch.img : null;
        if (imgUrl && imgUrl.includes('drive')) {
            const id = imgUrl.match(/\/d\/([a-zA-Z0-9_-]+)/) || imgUrl.match(/id=([a-zA-Z0-9_-]+)/);
            if (id) imgUrl = `https://drive.google.com/thumbnail?id=${id[1]}&sz=w200`; 
        }

        const imgHtml = imgUrl ? `<img src="${imgUrl}" alt="${p.servicio}" class="order-thumb-img">` : `<div class="order-thumb-fallback"><span class="material-icons-round">stars</span></div>`;

        const card = document.createElement('div');
        card.className = 'order-premium-card';
        card.style.animationDelay = `${index * 0.05}s`;
        card.innerHTML = `
            <div class="card-order-header">
                <div class="header-left-premium">
                    ${imgHtml} <div class="header-info-block">
                        <span class="service-name-premium">${p.servicio}</span>
                        <div class="status-indicator">
                            <span class="pulse-dot"></span><span class="status-text">SERVICIO ACTIVO</span>
                        </div>
                    </div>
                </div>
                <div class="header-right">
                    <span class="order-date">${fechaVal}</span><span class="order-time">${horaVal}</span>
                </div>
            </div>
            <div class="card-order-body-refined">
                <div class="credential-row">
                    <div class="cred-label-refined"><span class="material-icons-round">alternate_email</span> Usuario/Cuenta</div>
                    <div class="cred-value-refined select-all">${p.cuenta}</div>
                </div>
                <div class="credential-row">
                    <div class="cred-label-refined"><span class="material-icons-round">vpn_key</span> Contrase√±a</div>
                    <div class="cred-value-refined select-all">${p.clave}</div>
                </div>
            </div>
            <div class="card-order-footer">
                <div class="warranty-tag"><span class="material-icons-round verified-icon">verified</span><span style="font-size: 0.65rem;">GARANT√çA OFICIAL</span></div>
                <button class="btn-copy-premium-refined" onclick="copiarPedidoPremium('${p.servicio}', '${fechaVal} ${horaVal}', '${p.cuenta}', '${p.clave}')">
                    COPIAR DATOS <span class="material-icons-round" style="font-size:1rem;">content_copy</span>
                </button>
            </div>
        `;
        container.appendChild(card);
    });

    if (totalPags > 1) {
        const paginacionDiv = document.createElement('div');
        paginacionDiv.className = 'pagination-premium-container';
        const pagAnterior = pagActual - 1;
        const pagSiguiente = pagActual + 1;
        
        paginacionDiv.innerHTML = `
            <button type="button" class="btn-page" onclick="cargarPedidos(${pagAnterior})" ${pagActual <= 1 ? 'disabled' : ''}>
                <span class="material-icons-round">chevron_left</span> Anterior
            </button>
            <span class="page-indicator">P√°gina <b>${pagActual}</b> de <b>${totalPags}</b></span>
            <button type="button" class="btn-page" onclick="cargarPedidos(${pagSiguiente})" ${pagActual >= totalPags ? 'disabled' : ''}>
                Siguiente <span class="material-icons-round">chevron_right</span>
            </button>
        `;
        container.appendChild(paginacionDiv);
    }
}

/**
 * 3. COPIAR
 */
function copiarPedidoPremium(servicio, fechaCompleta, cuenta, clave) {
    const textoParaCopiar = `üåü JEICO STREAMING üåü\n\nServicio: ${servicio}\nüìß ID: ${cuenta}\nüîë Pass: ${clave}\nüìÖ Activado el: ${fechaCompleta}\n--------------------------\n¬°Que lo disfrutes!`;
    navigator.clipboard.writeText(textoParaCopiar).then(() => {
        Swal.fire({ toast: true, position: 'top-end', icon: 'success', title: '¬°Copiado!', showConfirmButton: false, timer: 1500, background: '#0a0a0a', color: '#fff' });
    });
}

/**
 * 4. INYECCI√ìN DE ESTILOS REFINADOS
 */
const pedidosRefinedStyles = `
    .orders-premium-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 25px; padding: 10px; }
    
    /* --- BUSCADOR PREMIUM --- */
    .search-premium-container {
        display: flex;
        align-items: center;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 8px 10px 8px 20px;
        margin-bottom: 30px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    }
    .search-premium-container:focus-within {
        border-color: var(--accent);
        box-shadow: 0 0 15px rgba(124, 58, 237, 0.2);
        background: #050505;
    }
    .search-icon { color: #555; font-size: 1.4rem; margin-right: 12px; }
    .search-premium-container input {
        flex-grow: 1;
        background: transparent;
        border: none;
        color: #fff;
        font-size: 0.95rem;
        outline: none;
        font-family: 'Inter', sans-serif;
    }
    .search-premium-container input::placeholder { color: #555; letter-spacing: 0.5px; }
    .btn-search-action {
        background: linear-gradient(135deg, var(--accent), #6366f1);
        color: #fff;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        font-weight: 800;
        font-size: 0.8rem;
        letter-spacing: 1px;
        cursor: pointer;
        transition: 0.3s;
        box-shadow: 0 5px 15px rgba(124, 58, 237, 0.3);
    }
    .btn-search-action:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 25px rgba(124, 58, 237, 0.5);
    }

    /* Tarjeta Principal */
    .order-premium-card {
        background: linear-gradient(160deg, #141414 0%, #080808 100%);
        border: 1px solid #1f1f1f;
        border-radius: 16px;
        padding: 22px;
        position: relative;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        transition: all 0.3s ease;
        animation: cardSlideIn 0.4s ease forwards;
        opacity: 0;
    }
    .order-premium-card:hover { border-color: rgba(124, 58, 237, 0.5); box-shadow: 0 15px 40px rgba(0,0,0,0.6), 0 0 20px rgba(124, 58, 237, 0.1); transform: translateY(-5px); }

    .card-order-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
    .header-left-premium { display: flex; align-items: center; gap: 12px; }
    
    .order-thumb-img { width: 48px; height: 48px; border-radius: 10px; object-fit: cover; border: 1px solid #2a2a2a; }
    .order-thumb-fallback { width: 48px; height: 48px; border-radius: 10px; background: #1a1a1a; display: flex; align-items: center; justify-content: center; border: 1px solid #2a2a2a; color: var(--accent); }

    .header-info-block { display: flex; flex-direction: column; }
    .service-name-premium { font-family: 'Righteous', sans-serif; font-size: 1.1rem; color: #fff; letter-spacing: 0.5px; line-height: 1.2; }
    .status-indicator { display: flex; align-items: center; gap: 6px; margin-top: 4px; }
    .pulse-dot { width: 6px; height: 6px; background: #00e676; border-radius: 50%; box-shadow: 0 0 8px #00e676; animation: pulseGreen 2s infinite; }
    .status-text { font-size: 0.6rem; font-weight: 800; color: #00e676; letter-spacing: 1px; }
    .header-right { text-align: right; }
    .order-date { color: #888; font-size: 0.75rem; font-weight: 600; display: block; }
    .order-time { color: #555; font-size: 0.7rem; font-family: monospace; }

    .card-order-body-refined { background: rgba(255, 255, 255, 0.02); border-radius: 12px; padding: 15px; border: 1px solid rgba(255, 255, 255, 0.05); }
    .credential-row { margin-bottom: 15px; }
    .credential-row:last-child { margin-bottom: 0; }
    .cred-label-refined { display: flex; align-items: center; gap: 6px; font-size: 0.65rem; color: var(--accent); font-weight: 700; letter-spacing: 1px; margin-bottom: 4px; text-transform: uppercase; }
    .cred-label-refined .material-icons-round { font-size: 0.9rem; }
    .cred-value-refined { font-family: 'Inter', monospace; font-size: 0.95rem; color: #e0e0e0; font-weight: 500; background: rgba(0,0,0,0.2); padding: 8px 10px; border-radius: 6px; border: 1px solid #1a1a1a; }
    .select-all { user-select: all; }

    .card-order-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #1a1a1a; }
    .warranty-tag { display: flex; align-items: center; gap: 5px; color: #555; font-weight: 700; }
    .verified-icon { color: var(--accent); font-size: 1rem; }
    
    .btn-copy-premium-refined {
        background: transparent; border: 1px solid var(--accent); color: var(--accent);
        padding: 8px 16px; border-radius: 50px; display: flex; align-items: center; gap: 8px;
        cursor: pointer; font-size: 0.7rem; font-weight: 800; letter-spacing: 1px; transition: 0.3s;
    }
    .btn-copy-premium-refined:hover { background: var(--accent); color: white; box-shadow: 0 0 15px rgba(124, 58, 237, 0.4); }

    /* Paginaci√≥n */
    .pagination-premium-container { grid-column: 1 / -1; display: flex; justify-content: center; align-items: center; gap: 20px; margin-top: 30px; padding: 20px; background: rgba(0,0,0,0.5); border-radius: 12px; border: 1px solid #1a1a1a; }
    .btn-page { display: flex; align-items: center; gap: 5px; background: transparent; color: var(--accent); border: 1px solid var(--accent); padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 800; font-size: 0.8rem; text-transform: uppercase; transition: 0.3s; }
    .btn-page:hover:not(:disabled) { background: var(--accent); color: #fff; box-shadow: 0 0 15px rgba(124, 58, 237, 0.4); }
    .btn-page:disabled { border-color: #333; color: #555; cursor: not-allowed; }
    .page-indicator { color: #aaa; font-size: 0.9rem; }
    .page-indicator b { color: #fff; }

    @keyframes cardSlideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulseGreen { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.5); opacity: 0.5; } 100% { transform: scale(1); opacity: 1; } }
    .no-orders-container { grid-column: 1/-1; text-align: center; padding: 80px 20px; border: 1px dashed #222; border-radius: 20px; }
`;

const styleSheetPedidos = document.createElement("style");
styleSheetPedidos.innerText = pedidosRefinedStyles;
document.head.appendChild(styleSheetPedidos);</script>
<script id="script-billetera.js">/* billetera.js */
/**
 * ===============================================================
 * BILLETERA.JS - GESTI√ìN DE SALDO ULTRA PREMIUM (PAGINACI√ìN BLINDADA)
 * ===============================================================
 */

let paginaActualBilletera = 1;
const WALLET_CACHE_KEY_PREFIX = "jeico_wallet_cache_p";

/**
 * 1. FUNCI√ìN PRINCIPAL DE CARGA
 */
async function cargarBilletera(paginaPedida = 1) {
    // Protecci√≥n absoluta: Forzamos a que sea un n√∫mero entero
    const targetPage = parseInt(paginaPedida) || 1;
    paginaActualBilletera = targetPage;
    
    const historyBody = document.getElementById('wallet-history');
    
    // Desplazamiento suave al cambiar de p√°gina
    if (targetPage > 1 || document.querySelector('.pagination-premium-container')) {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    const cacheKeyPagina = `${WALLET_CACHE_KEY_PREFIX}${targetPage}`;
    let cachedWalletStr = localStorage.getItem(cacheKeyPagina);
    
    // A. CARGA DESDE CACH√â (INSTANT√ÅNEA)
    if (cachedWalletStr) {
        try {
            renderMovimientos(JSON.parse(cachedWalletStr));
        } catch (e) { console.error("Error leyendo cach√© de billetera", e); }
    } else {
        historyBody.innerHTML = `
            <tr>
                <td colspan="4" style="text-align:center; padding:60px;">
                    <div class="spinner"></div>
                    <p style="color:#444; margin-top:15px; letter-spacing:2px; font-size:0.75rem;">CONSULTANDO P√ÅGINA ${targetPage}...</p>
                </td>
            </tr>`;
    }

    // B. SINCRONIZACI√ìN CON EL SERVIDOR (FONDO)
    const u = localStorage.getItem('jeico_user');
    const t = localStorage.getItem('jeico_token');

    try {
        // Forzamos el env√≠o de la p√°gina como String por si tu apiCall lo requiere as√≠
        const res = await apiCall({ accion: 'getMovimientos', usuario: u, token: t, pagina: String(targetPage) });

        if (res.success) {
            // Actualizaci√≥n manual de saldos (Evita recargas accidentales)
            let userBalance = Number(res.saldoActual) || 0;
            localStorage.setItem('jeico_saldo', userBalance); 
            
            const divBalanceBig = document.getElementById('wallet-balance-big');
            if (divBalanceBig) divBalanceBig.innerText = '$ ' + new Intl.NumberFormat('es-CO').format(userBalance);
            
            const divBalanceSidebar = document.getElementById('display-balance');
            if (divBalanceSidebar) divBalanceSidebar.innerText = '$ ' + new Intl.NumberFormat('es-CO').format(userBalance);

            const newWalletStr = JSON.stringify(res);
            
            if (cachedWalletStr !== newWalletStr) {
                localStorage.setItem(cacheKeyPagina, newWalletStr);
                renderMovimientos(res);
            }
        } else if (res.msg === "Sesi√≥n inv√°lida") {
            if (typeof logout === 'function') logout();
        }
    } catch (e) {
        console.error("Error cr√≠tico en Billetera:", e);
    }
}

/**
 * 2. RENDERIZADOR DE MOVIMIENTOS
 */
function renderMovimientos(respuestaServidor) {
    const historyBody = document.getElementById('wallet-history');
    if (!historyBody) return;
    
    historyBody.innerHTML = "";

    let movimientos = respuestaServidor.datos;
    // Forzamos lectura matem√°tica. Si el backend viejo responde, asignar√° 1 y evitar√° errores "NaN"
    const pagActual = parseInt(respuestaServidor.paginaActual) || 1;
    const totalPags = parseInt(respuestaServidor.totalPaginas) || 1;

    if (!movimientos || movimientos.length === 0) {
        historyBody.innerHTML = `
            <tr>
                <td colspan="4" style="text-align:center; padding:50px; color:#444; font-size:0.8rem; letter-spacing:1px;">
                    NO SE REGISTRAN MOVIMIENTOS EN ESTA P√ÅGINA.
                </td>
            </tr>`;
        
        const oldPag = document.getElementById('wallet-pagination');
        if (oldPag) oldPag.remove();
        return;
    }

    // ORDENAMIENTO FORZADO: Aseguramos que el m√°s reciente est√© arriba
    movimientos.sort((a, b) => {
        const fechaA = a.fecha ? new Date(a.fecha).getTime() : 0;
        const fechaB = b.fecha ? new Date(b.fecha).getTime() : 0;
        return fechaB - fechaA; 
    });

    movimientos.forEach((m, index) => {
        const montoNum = Number(m.monto) || 0;
        const saldoNuevoNum = Number(m.saldoNuevo) || 0;
        const esGasto = montoNum < 0;
        
        const colorMonto = esGasto ? 'var(--danger)' : 'var(--success)';
        const signo = esGasto ? '' : '+'; 
        
        const fechaOriginal = m.fecha ? new Date(m.fecha) : null;
        const fechaFormateada = fechaOriginal && !isNaN(fechaOriginal) 
            ? fechaOriginal.toLocaleDateString('es-CO', { day: '2-digit', month: '2-digit', year: 'numeric' })
            : '---';

        const row = document.createElement('tr');
        row.className = 'wallet-row-premium';
        row.style.animationDelay = `${index * 0.03}s`;
        
        row.innerHTML = `
            <td style="padding:18px 15px; text-align:center; color:#555; font-size:0.85rem; font-family:monospace;">
                ${fechaFormateada}
            </td>
            <td style="padding:18px 15px; text-align:center;">
                <div style="color:#eee; font-weight:600; font-size:0.85rem; text-transform:uppercase; letter-spacing:0.5px;">
                    ${m.motivo || 'Transacci√≥n'}
                </div>
            </td>
            <td style="padding:18px 15px; text-align:center;">
                <span style="color:${colorMonto}; font-weight:800; font-size:0.95rem;">
                    ${signo}$ ${new Intl.NumberFormat('es-CO').format(Math.abs(montoNum))}
                </span>
            </td>
            <td style="padding:18px 15px; text-align:center;">
                <span style="color:#aaa; font-weight:600; font-size:0.9rem; font-family:monospace;">
                    $ ${new Intl.NumberFormat('es-CO').format(saldoNuevoNum)}
                </span>
            </td>
        `;
        historyBody.appendChild(row);
    });

    // --- DIBUJAR CONTROLES DE PAGINACI√ìN FUERA DE LA TABLA ---
    let paginacionDiv = document.getElementById('wallet-pagination');
    
    if (totalPags > 1) {
        if (!paginacionDiv) {
            paginacionDiv = document.createElement('div');
            paginacionDiv.id = 'wallet-pagination';
            paginacionDiv.className = 'pagination-premium-container';
            document.querySelector('.table-responsive-wrapper').after(paginacionDiv);
        }
        
        // Matem√°ticas calculadas antes de inyectar al HTML para evitar fallos de Strings ("1"+"1"="11")
        const pagAnterior = pagActual - 1;
        const pagSiguiente = pagActual + 1;

        paginacionDiv.innerHTML = `
            <button type="button" class="btn-page" onclick="cargarBilletera(${pagAnterior})" ${pagActual <= 1 ? 'disabled' : ''}>
                <span class="material-icons-round">chevron_left</span> Anterior
            </button>
            <span class="page-indicator">P√°gina <b>${pagActual}</b> de <b>${totalPags}</b></span>
            <button type="button" class="btn-page" onclick="cargarBilletera(${pagSiguiente})" ${pagActual >= totalPags ? 'disabled' : ''}>
                Siguiente <span class="material-icons-round">chevron_right</span>
            </button>
        `;
    } else {
        if (paginacionDiv) paginacionDiv.remove();
    }
}

/**
 * 3. ESTILOS DIN√ÅMICOS
 */
const walletExtraStyles = `
    .premium-table { width: 100%; border-collapse: collapse; }
    .premium-table thead th { background: #050505; color: #444; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 2px; padding: 15px; border-bottom: 1px solid #1a1a1a; text-align: center; }
    .wallet-row-premium { border-bottom: 1px solid #0f0f0f; transition: all 0.3s ease; opacity: 0; animation: tableRowFadeIn 0.4s ease forwards; }
    .wallet-row-premium:hover { background: rgba(124, 58, 237, 0.03); }
    .table-responsive-wrapper { width: 100%; overflow-x: auto; }
    @keyframes tableRowFadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
`;

const styleSheetWallet = document.createElement("style");
styleSheetWallet.innerText = walletExtraStyles;
document.head.appendChild(styleSheetWallet);</script>
<script id="script-recarga.js">
    /* recarga.js */
/**
 * ===============================================================
 * RECARGA.JS - VERSI√ìN ULTRA-PREMIUM (BLINDADA & CENTRADA)
 * ===============================================================
 */

// 1. Configuraci√≥n de montos predeterminados
const RECHARGE_OPTIONS = [
    { monto: 10000, label: "Paquete Bronce", icon: "stars" },
    { monto: 20000, label: "Paquete Plata", icon: "auto_awesome" },
    { monto: 50000, label: "Paquete Oro", icon: "workspace_premium" },
    { monto: 100000, label: "Paquete Elite", icon: "diamond" }
];

let selectedAmount = null;

// ID de la imagen de WhatsApp en Drive para el thumbnail (Ajuste de visibilidad)
const WSP_ICON_ID = "12_hw1hRhhGNGv1UY7CX-YJajITFtrY-S";
const WSP_ICON_URL = `https://drive.google.com/thumbnail?id=${WSP_ICON_ID}&sz=w200`;

/**
 * 2. FUNCI√ìN PRINCIPAL DE CARGA
 * Genera la estructura centrada y arm√≥nica.
 */
function cargarRecarga() {
    const container = document.getElementById('sec-recarga');
    
    container.innerHTML = `
        <div class="recharge-wrapper-premium">
            <div class="page-header-premium">
                <h1 class="page-title">CENTRO DE RECARGAS</h1>
                <p class="page-subtitle">Selecciona un paquete o ingresa el valor deseado para fondear tu cuenta.</p>
            </div>

            <div class="recharge-grid-premium" id="recharge-options-container">
            </div>

            <div class="recharge-input-section">
                <p class="input-helper-text">O INGRESA UN MONTO PERSONALIZADO</p>
                <div class="recharge-custom-input-container">
                    <input type="number" id="custom-recharge" placeholder="Ejem: 15000" class="input-field-recharge" inputmode="numeric" oninput="limpiarSeleccionTarjetas()">
                </div>
            </div>

            <div class="recharge-actions-elite">
                <button onclick="enviarAlWhatsApp()" class="btn-action-recharge wsp">
                    <img src="${WSP_ICON_URL}" alt="WSP" class="btn-icon-wsp">
                    RECARGAR V√çA WHATSAPP
                </button>
                
                <button onclick="mostrarMantenimiento()" class="btn-action-recharge bank">
                    <span class="material-icons-round">account_balance</span>
                    PAGO BANCOLOMBIA
                </button>
            </div>
        </div>
    `;

    renderizarOpcionesRecarga();
}

/**
 * 3. RENDERIZADOR DE TARJETAS
 */
function renderizarOpcionesRecarga() {
    const container = document.getElementById('recharge-options-container');
    if (!container) return;
    container.innerHTML = "";

    RECHARGE_OPTIONS.forEach(opt => {
        const card = document.createElement('div');
        card.className = `recharge-card-premium ${selectedAmount === opt.monto ? 'active' : ''}`;
        card.onclick = () => seleccionarMonto(opt.monto, card);

        card.innerHTML = `
            <div class="recharge-card-icon">
                <span class="material-icons-round">${opt.icon}</span>
            </div>
            <div class="recharge-card-info">
                <span class="recharge-label">${opt.label}</span>
                <span class="recharge-price">$ ${new Intl.NumberFormat('es-CO').format(opt.monto)}</span>
            </div>
            <div class="selection-check">
                <span class="material-icons-round">check_circle</span>
            </div>
        `;
        container.appendChild(card);
    });
}

/**
 * 4. L√ìGICA DE SELECCI√ìN MUTUAMENTE EXCLUYENTE
 */
function seleccionarMonto(monto, element) {
    selectedAmount = monto;
    
    // Limpiar input personalizado al elegir tarjeta
    const customInput = document.getElementById('custom-recharge');
    if (customInput) customInput.value = "";

    // Actualizar estados visuales
    document.querySelectorAll('.recharge-card-premium').forEach(c => c.classList.remove('active'));
    element.classList.add('active');

    const Toast = Swal.mixin({
        toast: true, position: 'top-end', showConfirmButton: false, timer: 1000,
        background: '#0a0a0a', color: '#fff', iconColor: '#7c3aed'
    });
    Toast.fire({ icon: 'info', title: 'Monto fijado' });
}

// NUEVA FUNCI√ìN: Apaga las tarjetas si el usuario decide escribir un monto manual
function limpiarSeleccionTarjetas() {
    selectedAmount = null;
    document.querySelectorAll('.recharge-card-premium').forEach(c => c.classList.remove('active'));
}

/**
 * 5. ENV√çO A WHATSAPP (SOLUCI√ìN DEFINITIVA A CARACTERES EXTRA√ëOS)
 */
function enviarAlWhatsApp() {
    const customValue = document.getElementById('custom-recharge').value;
    const finalAmount = customValue ? parseInt(customValue) : selectedAmount;

    if (!finalAmount || finalAmount <= 0) {
        return Swal.fire({
            title: 'Monto Requerido',
            text: 'Por favor, selecciona un paquete o escribe un valor v√°lido.',
            icon: 'warning',
            background: '#0a0a0a',
            color: '#fff',
            confirmButtonColor: '#7c3aed'
        });
    }

    const u = localStorage.getItem('jeico_user') || 'Cliente';
    const montoFormateado = new Intl.NumberFormat('es-CO').format(finalAmount);
    
    // --- BYPASS DE ENCODING USANDO HEX PERCENT-ENCODING ---
    // Esto garantiza que los emojis se env√≠en bien sin importar el formato del archivo JS
    const starHex = "%F0%9F%8C%9F";
    const userHex = "%F0%9F%91%A4";
    const moneyHex = "%F0%9F%92%B0";
    const rocketHex = "%F0%9F%9A%80";

    const titulo = encodeURIComponent("*SOLICITUD DE RECARGA JEICO*");
    const userLabel = encodeURIComponent("*Usuario:*");
    const amountLabel = encodeURIComponent("*Monto a recargar:*");
    const despedida = encodeURIComponent("Favor indicarme los medios de pago disponibles. Quedo atento al comprobante.");

    // Construcci√≥n de URL cruda para evitar que el navegador corrompa los emojis
    const url = `https://wa.me/573016149753?text=${starHex}%20${titulo}%20${starHex}%0A%0A${userHex}%20${userLabel}%20${encodeURIComponent(u)}%0A${moneyHex}%20${amountLabel}%20${encodeURIComponent(montoFormateado)}%0A%0A${despedida}%20${rocketHex}`;

    window.open(url, '_blank');
}

/**
 * 6. MANTENIMIENTO BANCOLOMBIA
 */
function mostrarMantenimiento() {
    Swal.fire({
        title: 'Metodo de pago en Mantenimiento',
        text: 'El sistema de pagos autom√°ticos Bancolombia est√° siendo actualizado. Por ahora, usa WhatsApp.',
        icon: 'info',
        background: '#0a0a0a',
        color: '#fff',
        confirmButtonText: 'ENTENDIDO',
        confirmButtonColor: '#7c3aed'
    });
}

/**
 * 7. ESTILOS DE RECARGA (TODO CENTRADO Y SIN FLECHAS)
 */
const recargaStyles = `
    .recharge-wrapper-premium {
        max-width: 850px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        padding: 20px;
    }

    .recharge-grid-premium {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 20px;
        width: 100%;
        margin-bottom: 40px;
        justify-content: center;
    }

    .recharge-card-premium {
        background: rgba(15, 15, 15, 0.8);
        border: 1px solid #1a1a1a;
        padding: 30px 20px;
        border-radius: 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
    }

    .recharge-card-premium:hover {
        background: rgba(25, 25, 25, 1);
        border-color: #333;
        transform: translateY(-5px);
    }

    .recharge-card-premium.active {
        border-color: var(--accent);
        background: rgba(124, 58, 237, 0.1);
        box-shadow: 0 0 30px rgba(124, 58, 237, 0.2);
    }

    .recharge-card-icon span {
        font-size: 2.8rem;
        color: #222;
        margin-bottom: 15px;
        display: block;
    }

    .recharge-card-premium.active .recharge-card-icon span {
        color: var(--accent);
        text-shadow: 0 0 15px var(--accent-glow);
    }

    .recharge-label {
        display: block;
        font-size: 0.65rem;
        text-transform: uppercase;
        letter-spacing: 2px;
        color: #555;
        margin-bottom: 8px;
    }

    .recharge-price {
        display: block;
        font-size: 1.5rem;
        font-weight: 800;
        color: #fff;
        font-family: 'Inter', sans-serif;
    }

    .selection-check {
        position: absolute;
        top: 15px;
        right: 15px;
        color: var(--accent);
        opacity: 0;
        transition: 0.3s;
    }

    .recharge-card-premium.active .selection-check { opacity: 1; }

    .recharge-input-section {
        width: 100%;
        max-width: 400px;
        text-align: center;
        margin-bottom: 40px;
    }

    .input-helper-text {
        color: #444;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 2px;
        margin-bottom: 15px;
        font-weight: 700;
    }

    /* ELIMINAR FLECHAS DE INCREMENTO (SPINNERS) */
    .input-field-recharge::-webkit-outer-spin-button,
    .input-field-recharge::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    .input-field-recharge {
        -moz-appearance: textfield; /* Firefox */
        background: #000;
        border: 1px solid #1a1a1a;
        padding: 20px;
        border-radius: 15px;
        color: white;
        text-align: center;
        width: 100%;
        font-size: 1.3rem;
        font-weight: 600;
        transition: 0.3s;
    }

    .input-field-recharge:focus {
        border-color: var(--accent);
        outline: none;
        box-shadow: 0 0 20px rgba(124, 58, 237, 0.1);
    }

    .recharge-actions-elite {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
    }

    .btn-action-recharge {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        width: 100%;
        max-width: 400px;
        padding: 18px;
        border-radius: 50px;
        font-weight: 800;
        letter-spacing: 2px;
        cursor: pointer;
        transition: 0.3s;
        border: none;
        text-transform: uppercase;
        font-size: 0.85rem;
    }

    .btn-action-recharge.wsp {
        background: #25d366;
        color: #000;
    }

    .btn-action-recharge.wsp:hover {
        background: #20ba5a;
        box-shadow: 0 0 30px rgba(37, 211, 102, 0.2);
        transform: scale(1.02);
    }

    .btn-icon-wsp {
        width: 28px;
        height: 28px;
        object-fit: contain;
    }

    .btn-action-recharge.bank {
        background: transparent;
        border: 1px solid #1a1a1a;
        color: #444;
    }

    .btn-action-recharge.bank:hover {
        border-color: #333;
        color: #fff;
    }
`;

// Inyecci√≥n de estilos
const styleSheetRecarga = document.createElement("style");
styleSheetRecarga.innerText = recargaStyles;
document.head.appendChild(styleSheetRecarga);
</script>
<script id="script-soporte.js">
    /* soporte.js */
/**
 * ===============================================================
 * SOPORTE.JS - CENTRO DE AYUDA PREMIUM (FAQ & TICKETS MANUAL)
 * ===============================================================
 */

// Icono de WhatsApp (Opcional)
const WSP_SOPORTE_ICON_URL = `https://drive.google.com/thumbnail?id=12_hw1hRhhGNGv1UY7CX-YJajITFtrY-S&sz=w200`;

/**
 * 1. FUNCI√ìN PRINCIPAL DE CARGA
 */
function cargarSoporte() {
    const container = document.getElementById('sec-soporte');
    
    container.innerHTML = `
        <div class="soporte-wrapper-premium">
            <div class="page-header-premium" style="text-align: center; margin-bottom: 40px;">
                <h1 class="page-title">CENTRO DE AYUDA</h1>
                <p class="page-subtitle">Resolvemos tus dudas y garantizamos tu entretenimiento.</p>
            </div>

            <div class="support-grid">
                <div class="support-contact-card">
                    <div class="support-card-header">
                        <span class="material-icons-round" style="font-size: 3rem; color: var(--accent);">support_agent</span>
                        <h3>SOPORTE T√âCNICO</h3>
                        <p>Atenci√≥n prioritaria 24/7 para tus solicitudes.</p>
                    </div>
                    
                    <div class="support-action-buttons">
                        <button onclick="abrirModalTicket('FALLA DE ACCESO')" class="btn-ticket">
                            <span class="material-icons-round">gpp_maybe</span>
                            REPORTAR FALLA DE ACCESO
                        </button>
                        <button onclick="abrirModalTicket('RENOVACI√ìN')" class="btn-ticket">
                            <span class="material-icons-round">autorenew</span>
                            SOLICITAR RENOVACI√ìN
                        </button>
                        <button onclick="abrirModalTicket('DUDA / OTRO')" class="btn-ticket outline">
                            <span class="material-icons-round">help_outline</span>
                            OTRA CONSULTA
                        </button>
                    </div>
                    
                    <div class="warranty-info">
                        <span class="material-icons-round">verified</span>
                        <span>¬øTienes alg√∫n inconveniente? Cuentas con nuestro <b>respaldo y atenci√≥n</b>.</span>
                    </div>
                </div>

                <div class="faq-container">
                    <h3 class="faq-title">PREGUNTAS FRECUENTES</h3>
                    
                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>¬øCu√°nto tarda en entregarse una cuenta?</span>
                            <span class="material-icons-round arrow">expand_more</span>
                        </div>
                        <div class="faq-answer">
                            <div class="faq-answer-content">
                                El sistema es automatizado. Al comprar en la tienda con tu saldo, la cuenta se refleja inmediatamente en tu secci√≥n de "Mis Pedidos".
                            </div>
                        </div>
                    </div>

                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>¬øQu√© hago si alguien cambi√≥ la contrase√±a?</span>
                            <span class="material-icons-round arrow">expand_more</span>
                        </div>
                        <div class="faq-answer">
                            <div class="faq-answer-content">
                                No te preocupes. Usa el bot√≥n de la pesta√±a "C√≥digos", all√≠ podr√°s solicitar un c√≥digo y cambiar la clave de tu cuenta. De no ser posible, puedes optar por "Reportar Falla de Acceso" desde esta pantalla y nuestro equipo restablecer√° el servicio r√°pidamente.
                            </div>
                        </div>
                    </div>

                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>¬øPuedo modificar los perfiles?</span>
                            <span class="material-icons-round arrow">expand_more</span>
                        </div>
                        <div class="faq-answer">
                            <div class="faq-answer-content">
                                Est√° estrictamente prohibido cambiar contrase√±as, correos o nombres de perfiles que no te correspondan. Hacerlo anula la garant√≠a.
                            </div>
                        </div>
                    </div>

                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>¬øEn cu√°ntos dispositivos puedo ver?</span>
                            <span class="material-icons-round arrow">expand_more</span>
                        </div>
                        <div class="faq-answer">
                            <div class="faq-answer-content">
                                Cada compra equivale a un (1) perfil o pantalla, el cual es v√°lido para reproducir en un (1) solo dispositivo en simult√°neo. Compartir la cuenta puede causar bloqueos.
                            </div>
                        </div>
                    </div>

                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>¬øC√≥mo renuevo mi suscripci√≥n?</span>
                            <span class="material-icons-round arrow">expand_more</span>
                        </div>
                        <div class="faq-answer">
                            <div class="faq-answer-content">
                                Las cuentas tienen una duraci√≥n de 30 d√≠as. Para seguir disfrutando, puedes volver a comprar en la tienda o usar el bot√≥n "Solicitar Renovaci√≥n" si deseas intentar mantener tu perfil actual.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="ticket-modal-overlay" class="ticket-overlay hidden">
            <div class="ticket-modal-content">
                <div class="ticket-modal-header">
                    <h2>NUEVO TICKET</h2>
                    <button class="btn-close-ticket" onclick="cerrarModalTicket()">
                        <span class="material-icons-round">close</span>
                    </button>
                </div>
                <div class="ticket-modal-body">
                    <p class="ticket-help-text">Por favor, detalla tu solicitud para que podamos ayudarte m√°s r√°pido.</p>
                    
                    <div class="input-group-premium">
                        <label>TIPO DE SOLICITUD</label>
                        <input type="text" id="ticket-tipo" class="ticket-input readonly" readonly>
                    </div>

                    <div class="input-group-premium">
                        <label>CUENTA A REPORTAR (Opcional)</label>
                        <input type="text" id="ticket-cuenta-input" class="ticket-input" placeholder="Ej: Disney+ o micorreo@gmail.com" autocomplete="off">
                    </div>

                    <div class="input-group-premium">
                        <label>DETALLES DEL PROBLEMA</label>
                        <textarea id="ticket-contexto" class="ticket-textarea" placeholder="Expl√≠canos qu√© sucede o qu√© necesitas..."></textarea>
                    </div>

                    <button class="btn-submit-ticket" onclick="enviarTicketBD()">
                        ENVIAR REPORTE <span class="material-icons-round">send</span>
                    </button>
                </div>
            </div>
        </div>
    `;
}

/**
 * 2. L√ìGICA DE ACORDE√ìN PARA FAQ
 */
function toggleFAQ(element) {
    document.querySelectorAll('.faq-item').forEach(item => {
        if (item !== element) item.classList.remove('active');
    });
    element.classList.toggle('active');
}

/**
 * 3. L√ìGICA DEL MODAL (SIN CARGA DE DATOS)
 */
function abrirModalTicket(tipo) {
    const modal = document.getElementById('ticket-modal-overlay');
    const inputTipo = document.getElementById('ticket-tipo');
    const inputCuenta = document.getElementById('ticket-cuenta-input');
    
    if (modal && inputTipo && inputCuenta) {
        // Reset de campos
        inputTipo.value = tipo;
        document.getElementById('ticket-contexto').value = "";
        inputCuenta.value = "";
        
        // Mostrar modal
        modal.classList.remove('hidden');
        setTimeout(() => modal.classList.add('show'), 10); // Peque√±o delay para que corra la transici√≥n CSS
    }
}

function cerrarModalTicket() {
    const modal = document.getElementById('ticket-modal-overlay');
    if (modal) {
        modal.classList.remove('show');
        setTimeout(() => modal.classList.add('hidden'), 300); // Espera a que termine la transici√≥n CSS
    }
}

/**
 * 4. ENV√çO DEL TICKET Y ACTUALIZACI√ìN DE CACH√â LOCAL
 */
async function enviarTicketBD() {
    const u = localStorage.getItem('jeico_user');
    const t = localStorage.getItem('jeico_token');
    
    const tipo = document.getElementById('ticket-tipo').value;
    const cuentaSeleccionada = document.getElementById('ticket-cuenta-input').value.trim();
    const contextoRaw = document.getElementById('ticket-contexto').value.trim();

    if (!contextoRaw) {
        return Swal.fire({
            icon: 'warning', title: 'Faltan datos',
            text: 'Por favor explica brevemente tu problema en los detalles.',
            background: '#0a0a0a', color: '#fff'
        });
    }

    // Unimos la cuenta manual con el mensaje del usuario
    const contextoFinal = (cuentaSeleccionada && cuentaSeleccionada !== "") 
        ? `[Sobre: ${cuentaSeleccionada}] \n\nDetalle: ${contextoRaw}` 
        : contextoRaw;

    Swal.fire({ 
        title: 'ENVIANDO TICKET', 
        text: 'Registrando en el sistema de soporte...',
        didOpen: () => Swal.showLoading(), 
        background: '#0a0a0a', color:'#fff',
        allowOutsideClick: false,
        customClass: { container: 'swal-top-layer' }
    });

    try {
        const res = await apiCall({ 
            accion: 'crearTicket', 
            usuario: u, 
            token: t, 
            tipo: tipo, 
            contexto: contextoFinal 
        });

        if (res.success) {
            cerrarModalTicket();
            
            // --- INYECCI√ìN EN CACH√â DE MISTICKETS CON ID REAL ---
            
            // IMPORTANTE: Aseg√∫rate de que tu Google Script devuelva "fila" en el JSON
            // Si el script no devuelve fila, usamos 0 (pero 0 dar√° error al cerrar si no se actualiza)
            const idFilaReal = res.fila ? res.fila : 0;

            const nuevoTicketVirtual = {
                tipo: tipo,
                fecha: new Date().toISOString(), // Fecha actual
                estado: 'Abierto',
                contexto: contextoFinal,
                respuesta: '',
                fila: idFilaReal // <--- AQUI GUARDAMOS LA FILA REAL QUE VINO DEL SERVER
            };

            const cacheKey = 'jeico_tickets_cache_v30min';
            let cachedData = { timestamp: Date.now(), datos: [] };
            const rawCache = localStorage.getItem(cacheKey);

            if (rawCache) {
                try {
                    cachedData = JSON.parse(rawCache);
                    if (!Array.isArray(cachedData.datos)) cachedData.datos = [];
                } catch (e) { }
            }

            // Agregamos al inicio
            cachedData.datos.unshift(nuevoTicketVirtual);
            
            // RESETEAMOS EL RELOJ DE 30 MINUTOS
            cachedData.timestamp = Date.now();

            // Guardamos
            localStorage.setItem(cacheKey, JSON.stringify(cachedData));
            // ----------------------------------------

            Swal.fire({
                icon: 'success',
                title: 'TICKET CREADO',
                text: 'En la mayor brevedad se te dar√° soluci√≥n...',
                background: '#0a0a0a', 
                color: '#fff', 
                timer: 4000, 
                showConfirmButton: false
            });
            
        } else {
            Swal.fire({ icon: 'error', title: 'Error', text: res.msg, background: '#0a0a0a', color: '#fff' });
        }
    } catch (error) {
        Swal.fire({ icon: 'error', title: 'Falla de conexi√≥n', text: 'Revisa tu internet.', background: '#0a0a0a', color: '#fff' });
    }
}

/**
 * 5. ESTILOS DE SOPORTE PREMIUM (LIMPIOS)
 */
const soporteStyles = `
    .soporte-wrapper-premium {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .support-grid {
        display: grid;
        grid-template-columns: 1fr 1.2fr;
        gap: 40px;
        width: 100%;
        margin-top: 20px;
    }

    .support-contact-card {
        background: linear-gradient(145deg, #0a0a0a 0%, #050505 100%);
        border: 1px solid #1a1a1a;
        border-radius: 20px;
        padding: 40px 30px;
        text-align: center;
        box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        height: fit-content;
    }

    .support-card-header h3 { color: #fff; font-family: 'Righteous', cursive; letter-spacing: 1px; margin: 15px 0 10px 0; }
    .support-card-header p { color: #777; font-size: 0.85rem; line-height: 1.5; margin-bottom: 30px; }

    .support-action-buttons { display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px; }
    
    .btn-ticket {
        background: rgba(124, 58, 237, 0.1); border: 1px solid var(--accent); color: #fff;
        padding: 16px; border-radius: 12px; display: flex; align-items: center; justify-content: center; gap: 10px;
        font-weight: 700; cursor: pointer; transition: 0.3s; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px;
    }
    .btn-ticket:hover { background: var(--accent); box-shadow: 0 0 20px var(--accent-glow); transform: translateY(-3px); }
    .btn-ticket.outline { background: transparent; border: 1px solid #333; color: #aaa; }
    .btn-ticket.outline:hover { border-color: #fff; color: #fff; background: rgba(255,255,255,0.05); box-shadow: none; }

    .warranty-info {
        display: flex; align-items: center; justify-content: center; gap: 8px; color: var(--success);
        font-size: 0.75rem; background: rgba(5, 150, 105, 0.1); padding: 12px; border-radius: 8px; border: 1px solid rgba(5, 150, 105, 0.2);
    }

    /* ACORDE√ìN FAQ MEJORADO */
    .faq-container { display: flex; flex-direction: column; gap: 15px; }
    .faq-title { color: #fff; font-family: 'Righteous', cursive; letter-spacing: 1px; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #1a1a1a; }
    .faq-item { background: #0a0a0a; border: 1px solid #1a1a1a; border-radius: 12px; overflow: hidden; cursor: pointer; transition: 0.3s; }
    .faq-item:hover { border-color: #333; }
    .faq-item.active { border-color: var(--accent); background: rgba(124, 58, 237, 0.05); }
    .faq-question { padding: 20px; display: flex; justify-content: space-between; align-items: center; font-weight: 600; color: #e5e5e5; font-size: 0.95rem; }
    .faq-question .arrow { transition: transform 0.4s ease; color: var(--accent); }
    .faq-item.active .faq-question .arrow { transform: rotate(180deg); }
    
    /* Hack para animaci√≥n suave del acorde√≥n */
    .faq-answer {
        display: grid;
        grid-template-rows: 0fr;
        transition: grid-template-rows 0.4s ease-out;
    }
    .faq-item.active .faq-answer {
        grid-template-rows: 1fr;
    }
    .faq-answer-content {
        overflow: hidden;
        color: #888; 
        font-size: 0.85rem; 
        line-height: 1.6;
        padding: 0 20px;
        opacity: 0;
        transition: opacity 0.4s ease-out, padding 0.4s ease-out;
    }
    .faq-item.active .faq-answer-content {
        padding: 0 20px 20px 20px;
        opacity: 1;
    }

    /* =========================================
       DISE√ëO MODAL DE TICKET (FIX Z-INDEX)
       ========================================= */
    .ticket-overlay {
        position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
        background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
        z-index: 99999; /* Z-index alt√≠simo para tapar men√∫, navs, etc */
        display: flex; align-items: center; justify-content: center;
        opacity: 0; transition: opacity 0.3s ease; pointer-events: none;
    }
    .ticket-overlay.show { opacity: 1; pointer-events: auto; }
    
    .ticket-modal-content {
        background: #050505; border: 1px solid #1a1a1a; border-radius: 16px;
        width: 90%; max-width: 450px; overflow: visible;
        transform: translateY(20px); transition: transform 0.3s ease;
        box-shadow: 0 20px 50px rgba(0,0,0,0.9), 0 0 30px rgba(124, 58, 237, 0.15);
    }
    .ticket-overlay.show .ticket-modal-content { transform: translateY(0); }

    .ticket-modal-header {
        background: var(--accent); padding: 20px; display: flex;
        justify-content: space-between; align-items: center; border-radius: 16px 16px 0 0;
    }
    .ticket-modal-header h2 { color: #fff; font-size: 1.1rem; letter-spacing: 2px; margin: 0; font-weight: 800;}
    .btn-close-ticket { background: none; border: none; color: #fff; cursor: pointer; display: flex; padding: 0; transition: 0.2s;}
    .btn-close-ticket:hover { transform: scale(1.1); }

    .ticket-modal-body { padding: 30px 25px; }
    .ticket-help-text { color: #777; font-size: 0.8rem; margin-bottom: 25px; text-align: center; }

    .input-group-premium { margin-bottom: 20px; display: flex; flex-direction: column; gap: 8px; text-align: left; }
    .input-group-premium label { color: var(--accent); font-size: 0.7rem; font-weight: 800; letter-spacing: 1px; }
    
    .ticket-input, .ticket-textarea {
        background: #0a0a0a; border: 1px solid #222; border-radius: 8px;
        padding: 12px 15px; color: #fff; font-family: 'Inter', sans-serif;
        font-size: 0.9rem; outline: none; transition: 0.3s; width: 100%; box-sizing: border-box;
    }
    .ticket-input:focus, .ticket-textarea:focus { border-color: var(--accent); box-shadow: 0 0 10px rgba(124,58,237,0.2); }
    .ticket-input.readonly { color: #888; background: #000; cursor: not-allowed; font-weight: bold;}
    
    .ticket-textarea { height: 100px; resize: none; }

    .btn-submit-ticket {
        width: 100%; background: var(--success); color: #fff; border: none;
        padding: 16px; border-radius: 8px; font-weight: 800; letter-spacing: 1px;
        cursor: pointer; display: flex; align-items: center; justify-content: center;
        gap: 10px; transition: 0.3s; margin-top: 10px;
    }
    .btn-submit-ticket:hover { background: #047857; transform: scale(1.02); }

    @media (max-width: 768px) { .support-grid { grid-template-columns: 1fr; gap: 30px; } }
`;

const styleSheetSoporte = document.createElement("style");
styleSheetSoporte.innerText = soporteStyles;
document.head.appendChild(styleSheetSoporte);
</script>
<script id="script-codigo.js">
    /**
 * ===============================================================
 * CODIGOS.JS - PORTAL DE ACCESO SEGURO (MANUAL / SIN AUTOCOMPLETE)
 * ===============================================================
 */

// ============================================================
// CONFIGURACI√ìN DE ENDPOINTS
// ============================================================
const URL_MAESTRO = "https://script.google.com/macros/s/AKfycbyZu-05L75tVwAvJjN7gQ7JQZ7EyxgEUhT723Jd9tXHjdAvZaVXGE6AsENiwyyQX_ukwQ/exec";
const LISTA_OBREROS = [
    "https://script.google.com/macros/s/AKfycbxRf-m0Z3xjDwRrps5Ia3zdGZtWKioxPj3h3nrexlCzOawt7fzdFgeC_xeqj-zsCJzCrA/exec",
    "https://script.google.com/macros/s/AKfycbyHVbLbV2jhNYPDyxjmp9yIKO9HWAl3IxvO1qAuvMRlVZdFUCGD88U6OsJw8mnpSS3X/exec",
    "https://script.google.com/macros/s/AKfycbyD_7GCUkn2t5O7kl95mU7riGMOiy0hNJtPduv6Sf_37mxfSm50OnMn4aRWlsl7wN7e/exec",
    "https://script.google.com/macros/s/AKfycbxUuHwtfFTW2bnOUBHkw3TkVVoQi9hH4Kk_y96T6XIC6VMwl9qeZmZZckmoySgZnXil/exec",
    "https://script.google.com/macros/s/AKfycbw-V7SRUufYl5hkAWcLV8ajQbCa0vzTD3iwklRas2_ddY4YAzzVAE59XgdeVmLmUrBRDQ/exec"
];

const COOLDOWN_CODIGOS = 20; // Segundos
let enCooldownCodigos = false;

/**
 * 1. FUNCI√ìN PRINCIPAL DE CARGA DE LA VISTA
 */
function cargarCodigos() {
    const container = document.getElementById('sec-codigos');
    if (!container) return;

    // Se elimin√≥ la lista UL y los eventos oninput/onclick del input de correo
    container.innerHTML = `
        <div class="codigos-wrapper-premium">
            <div class="page-header-premium" style="text-align: center; margin-bottom: 30px;">
                <h1 class="page-title">PORTAL DE <span>C√ìDIGOS</span></h1>
                <p class="page-subtitle">Obt√©n tu acceso de 6 d√≠gitos o enlace de restablecimiento al instante.</p>
            </div>

            <div class="card-codigos">
                <div id="formAccesoCodigos">
                    
                    <div class="input-group-premium" style="position: relative; margin-bottom: 20px;">
                        <label>Correo de la Cuenta</label>
                        <div class="input-wrapper">
                            <span class="material-icons-round input-icon">email</span>
                            <input type="email" id="txtUserCod" class="ticket-input" placeholder="ejemplo@gmail.com" autocomplete="off">
                        </div>
                    </div>

                    <div class="input-group-premium" style="margin-bottom: 20px;">
                        <label>Contrase√±a de Acceso</label>
                        <div class="input-wrapper">
                            <span class="material-icons-round input-icon">lock</span>
                            <input type="password" id="txtPassCod" class="ticket-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            <span class="material-icons-round toggle-password" id="togglePassCod" onclick="togglePasswordVisibilidad()">visibility</span>
                        </div>
                    </div>

                    <div class="input-group-premium">
                        <label>Selecciona el Servicio</label>
                        <div class="services-grid">
                            <button type="button" class="btn-service-brand active" data-asunto="Tu c√≥digo de acceso √∫nico para Disney+" data-brand="Disney">
                                <span class="brand-icon">D+</span> Disney+
                            </button>
                            <button type="button" class="btn-service-brand" data-asunto="Urgente: Tu c√≥digo de un solo uso||Tu enlace para restablecer tu contrase√±a requerido" data-brand="HBO">
                                <span class="brand-icon">H+</span> HBO+
                            </button>
                            <button type="button" class="btn-service-brand" data-asunto="Verificaci√≥n de Amazon" data-brand="Amazon">
                                <span class="brand-icon">AMZ</span> Amazon
                            </button>
                            <button type="button" class="btn-service-brand" data-asunto="Reset Your Crunchyroll Password||Restablece tu contrase√±a de Crunchyroll" data-brand="Crunchyroll">
                                <span class="brand-icon">CR</span> Crunchy
                            </button>
                        </div>
                        <input type="hidden" id="txtAsuntoCod" value="Tu c√≥digo de acceso √∫nico para Disney+">
                    </div>

                    <button id="btnVerificarCod" class="btn-submit-ticket" onclick="ejecutarAccesoCodigos()" style="margin-top: 25px;">
                        <span class="material-icons-round" id="btnIconCod">smart_toy</span>
                        <span id="btnTextCod">OBTENER C√ìDIGO</span>
                    </button>
                </div>

                <div id="statusAreaCod" class="status-msg-cod info-cod hidden" style="margin-top:20px;">
                    <span class="material-icons-round icon-status">terminal</span>
                    <span id="statusTextCod">Sistema listo.</span>
                </div>

                <div id="resultadoFinalCod" class="result-container-cod hidden">
                    <div class="result-label" id="resultLabelCod">C√ìDIGO DE VERIFICACI√ìN</div>
                    <div id="codigoGrande" class="code-display">000000</div>
                    <div id="fechaMsgCod" class="fecha-msg"></div>
                </div>

                <div id="fallbackAreaCod" class="fallback-msg hidden" style="margin-top:20px;">
                    <p>¬øNo llega el c√≥digo? <br><span style="font-size:13px; color:#aaa;">Es posible que debas solicitarlo nuevamente en la plataforma original.</span></p>
                    <a id="btnSolicitarManualCod" href="#" target="_blank" class="btn-manual-request">
                        Solicita el c√≥digo manualmente <span class="material-icons-round" style="font-size:14px;">open_in_new</span>
                    </a>
                </div>
            </div>
        </div>
    `;

    // Inicializar l√≥gica de la vista (Botones de servicio)
    initServiceButtonsCodigos();
    
    // NOTA: Se ha eliminado la llamada a cargarCuentasParaAutocomplete()
    // y los EventListeners del dropdown.

    // Enter para ejecutar
    document.getElementById("txtPassCod").addEventListener("keydown", e => {
        if (e.key === "Enter") ejecutarAccesoCodigos();
    });
}

/**
 * 2. L√ìGICA DE INTERFAZ (BOTONES, TOGGLE PASS)
 */
function togglePasswordVisibilidad() {
    const passInput = document.getElementById("txtPassCod");
    const toggleIcon = document.getElementById("togglePassCod");
    
    if (passInput.type === "password") {
        passInput.type = "text";
        toggleIcon.innerText = "visibility_off";
        toggleIcon.style.color = "var(--success)";
    } else {
        passInput.type = "password";
        toggleIcon.innerText = "visibility";
        toggleIcon.style.color = "var(--accent)";
    }
}

function initServiceButtonsCodigos() {
    const botones = document.querySelectorAll(".btn-service-brand");
    const inputAsunto = document.getElementById("txtAsuntoCod");
    const btnVerificar = document.getElementById("btnVerificarCod");
    const btnText = document.getElementById("btnTextCod");
    
    botones.forEach(boton => {
        boton.addEventListener("click", () => {
            if(boton.disabled) return;

            botones.forEach(b => b.classList.remove("active"));
            boton.classList.add("active");
            
            const asuntoSeleccionado = boton.getAttribute("data-asunto");
            const brand = boton.getAttribute("data-brand");
            inputAsunto.value = asuntoSeleccionado;

            // L√ìGICA DE BLOQUEO (AMAZON)
            if (brand === "Amazon") {
                btnVerificar.disabled = true;
                btnText.innerText = "Pr√≥ximamente";
                
                Swal.fire({
                    toast: true, position: 'top-end', icon: 'info',
                    title: 'Servicio en Mantenimiento',
                    text: 'Amazon estar√° disponible pronto.',
                    showConfirmButton: false, timer: 3000,
                    background: '#0a0a0a', color: '#ff9900'
                });
            } else {
                if (!enCooldownCodigos) {
                    btnVerificar.disabled = false;
                    btnText.innerText = "OBTENER C√ìDIGO";
                }
            }
        });
    });
}

/**
 * 3. N√öCLEO DE EXTRACCI√ìN Y API
 */
async function faseIA(texto, icono, delay = 700) {
    const status = document.getElementById("statusAreaCod");
    const textEl = document.getElementById("statusTextCod");
    const iconEl = status.querySelector(".icon-status");
    
    status.classList.remove('hidden', 'error', 'success');
    status.classList.add('info-cod');
    
    iconEl.innerText = icono;
    textEl.innerHTML = texto;
    
    await new Promise(resolve => setTimeout(resolve, delay));
}

function iniciarCooldownCodigos() {
    enCooldownCodigos = true;
    let restante = COOLDOWN_CODIGOS;
    const btn = document.getElementById("btnVerificarCod");
    const txtBtn = document.getElementById("btnTextCod");
    const iconBtn = document.getElementById("btnIconCod");

    btn.disabled = true;

    const timer = setInterval(() => {
        restante--;
        txtBtn.innerText = `ESPERA ${restante}s`;

        if (restante <= 0) {
            clearInterval(timer);
            enCooldownCodigos = false;
            btn.disabled = false;
            txtBtn.innerText = "OBTENER C√ìDIGO";
            if(iconBtn) iconBtn.innerText = "smart_toy";
        }
    }, 1000);
}

async function ejecutarAccesoCodigos() {
    if (enCooldownCodigos) return;

    const user = document.getElementById("txtUserCod").value.trim();
    const pass = document.getElementById("txtPassCod").value.trim();
    const asunto = document.getElementById("txtAsuntoCod").value.trim(); 
    
    const botonActivo = document.querySelector(".btn-service-brand.active");
    const nombreServicioCorto = botonActivo ? botonActivo.getAttribute("data-brand") : "";
    
    const btn = document.getElementById("btnVerificarCod");
    const txtBtn = document.getElementById("btnTextCod");
    const iconBtn = document.getElementById("btnIconCod");
    const status = document.getElementById("statusAreaCod");
    const textEl = document.getElementById("statusTextCod");
    const resBox = document.getElementById("resultadoFinalCod");
    const codigoGrande = document.getElementById("codigoGrande");
    const fechaMsg = document.getElementById("fechaMsgCod");
    const fallbackArea = document.getElementById("fallbackAreaCod"); 
    const btnManual = document.getElementById("btnSolicitarManualCod"); 
    const resultLabel = document.getElementById("resultLabelCod"); 

    if (!user || !pass) {
        Swal.fire({ icon: 'error', title: 'Faltan datos', text: 'Ingresa correo y contrase√±a.', background: '#0a0a0a', color: '#fff' });
        return;
    }

    // Reset visual
    btn.disabled = true;
    txtBtn.innerText = "PROCESANDO...";
    iconBtn.innerText = "sync";
    iconBtn.classList.add("fa-spin"); 
    resBox.classList.add("hidden");
    fallbackArea.classList.add("hidden"); 

    try {
        await faseIA("Inicializando motor de b√∫squeda...", "memory");
        await faseIA("Validando credenciales en la B√≥veda...", "security");

        // 1. LOGIN MAESTRO
        const login = await fetch(`${URL_MAESTRO}?usuario=${encodeURIComponent(user)}&clave=${encodeURIComponent(pass)}&servicio=${encodeURIComponent(nombreServicioCorto)}`);
        const dataM = await login.json();

        if (!dataM.exito) {
            throw new Error(dataM.mensaje || "Credenciales inv√°lidas.");
        }

        await faseIA("Acceso autorizado. Conectando servidores...", "public");
        await faseIA("Analizando bandeja de entrada...", "psychology");

        let codigoFinal = "";
        let infoExito = null;

        // 2. B√öSQUEDA EN WORKERS
        for (let i = 0; i < LISTA_OBREROS.length; i++) {
            try {
                const r = await fetch(`${LISTA_OBREROS[i]}?usuario=${encodeURIComponent(user)}&asunto=${encodeURIComponent(asunto)}`);
                const d = await r.json();

                if (d.exito && d.encontrado) {
                    codigoFinal = extraerDatosCorreo(asunto, d.cuerpo);
                    if (codigoFinal) {
                        infoExito = d;
                        break;
                    }
                }
            } catch { /* Silencio en errores de red del worker */ }
        }

        if (!codigoFinal) throw new Error("NOT_FOUND");
        
        // 3. RENDERIZADO DEL RESULTADO
        if (codigoFinal.startsWith("http")) {
            resultLabel.innerText = "ENLACE DE RECUPERACI√ìN";
            codigoGrande.innerHTML = `<a href="${codigoFinal}" target="_blank" class="btn-link-neon"><span class="material-icons-round" style="font-size:18px;">open_in_new</span> RESTABLECE<br>TU CLAVE AQU√ç</a>`;
            codigoGrande.style.fontSize = "16px"; 
            codigoGrande.style.letterSpacing = "normal";
        } else {
            resultLabel.innerText = "C√ìDIGO DE VERIFICACI√ìN";
            codigoGrande.innerText = codigoFinal;
            codigoGrande.style.fontSize = "48px";
            codigoGrande.style.letterSpacing = "6px";
        }

        // Registro pasivo (Opcional)
        fetch(`${URL_MAESTRO}?accion=registrar_codigo&usuario=${encodeURIComponent(user)}&codigo_encontrado=${encodeURIComponent(codigoFinal.substring(0,50))}`, { mode: "no-cors" });

        fechaMsg.innerHTML = `<span class="material-icons-round" style="font-size:14px;">schedule</span> Recibido a las: ${infoExito.hora || "Reciente"}`;
        resBox.classList.remove("hidden");

        status.className = "status-msg-cod success";
        status.querySelector(".icon-status").innerText = "check_circle";
        textEl.innerText = "Proceso finalizado. Informaci√≥n recuperada.";

        // √âxito
        iconBtn.classList.remove("fa-spin");
        iniciarCooldownCodigos();

    } catch (err) {
        status.className = "status-msg-cod error";
        status.querySelector(".icon-status").innerText = "error";
        
        if (err.message === "Cuenta sin ese servicio") {
            textEl.innerHTML = "No tienes este servicio contratado.<br>Contacta a soporte si crees que es un error.";
        }
        else if (err.message === "NOT_FOUND" || err.message.includes("No se encontr√≥")) {
            textEl.innerText = "No se encontr√≥ informaci√≥n reciente.";
            
            let linkManual = "#";
            if (asunto.includes("Disney")) linkManual = "https://www.disneyplus.com/identity/login/enter-passcode";
            else if (asunto.includes("Crunchyroll") || asunto.includes("Reset")) linkManual = "https://sso.crunchyroll.com/es/reset-password";
            else if (asunto.includes("HBO") || asunto.includes("Urgente") || asunto.includes("restablecer")) linkManual = "https://auth.hbomax.com/login"; 
            
            if (btnManual) {
                btnManual.href = linkManual;
                fallbackArea.classList.remove("hidden");
            }
        } else {
            textEl.innerText = err.message;
        }

        btn.disabled = false;
        txtBtn.innerText = "INTENTAR DE NUEVO";
        iconBtn.classList.remove("fa-spin");
        iconBtn.innerText = "refresh";
    }
}

/**
 * 4. MOTOR DE EXTRACCI√ìN DE TEXTO
 */
function extraerDatosCorreo(asunto, cuerpoOriginal) {
    let codigoFinal = null;
    let match = null;
    const textoAplanado = cuerpoOriginal.replace(/\s+/g, " ");

    if (asunto.includes("HBO") || asunto.includes("Urgente") || asunto.includes("restablecer")) {
        const matchCode = textoAplanado.match(/un\s+solo\s+uso.*?(\d{6})/i);
        if (matchCode) return matchCode[1];

        let textoLink = textoAplanado;
        const frase = "RESTABLECER CONTRASE√ëA";
        let textoMayusculas = textoLink.toUpperCase();
        
        let idx1 = textoMayusculas.indexOf(frase);
        if (idx1 !== -1) {
            textoLink = textoLink.substring(idx1);
            textoMayusculas = textoLink.toUpperCase(); 
            
            let idx2 = textoMayusculas.indexOf(frase, frase.length);
            if (idx2 !== -1) {
                textoLink = textoLink.substring(0, idx2);
                textoLink = textoLink.replace(/RESTABLECER\s+CONTRASE.A/ig, "");
                textoLink = textoLink.replace(/[()]/g, "");
                textoLink = textoLink.replace(/\s+/g, "");
                
                if (textoLink.startsWith("http")) codigoFinal = textoLink;
            }
        }
    }
    else if (asunto.includes("Crunchyroll")) {
        const regexCrunchy = /https:\/\/links\.mail\.crunchyroll\.com\/ls\/click[^>"\s]+/g;
        const linksCrunchy = textoAplanado.match(regexCrunchy);
        if (linksCrunchy) {
            codigoFinal = (linksCrunchy.length >= 2 ? linksCrunchy[1] : linksCrunchy[0]).replace(/\s/g, "");
        }
    }
    else if (asunto.includes("Disney+")) {
        match = textoAplanado.match(/(\d{6})\s*Si\s+no\s+lo\s+solicitaste/i) || textoAplanado.match(/\b(\d{6})\b/);
        if (match) codigoFinal = match[1];
    }
    
    if (!codigoFinal) {
        match = textoAplanado.match(/\b(\d{6})\b/);
        if (match) codigoFinal = match[1];
    }

    return codigoFinal;
}

/**
 * 5. ESTILOS INTEGRADOS (GOTH PREMIUM + BRAND COLORS)
 */
const codigosStyles = `
    .codigos-wrapper-premium {
        max-width: 500px;
        margin: 0 auto;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .card-codigos {
        background: linear-gradient(145deg, #0a0a0a 0%, #050505 100%);
        border: 1px solid #1a1a1a;
        padding: 40px 30px;
        border-radius: 24px;
        width: 100%;
        box-shadow: 0 20px 50px rgba(0,0,0,0.8), 0 0 20px rgba(124, 58, 237, 0.1);
    }

    .page-title span { color: var(--accent); text-shadow: 0 0 15px var(--accent-glow); }

    /* INPUTS */
    .input-wrapper { position: relative; display: flex; align-items: center; }
    .input-icon { position: absolute; left: 15px; color: var(--accent); font-size: 20px; }
    .toggle-password { position: absolute; right: 15px; cursor: pointer; color: var(--accent); font-size: 20px; transition: 0.3s; }
    .toggle-password:hover { color: var(--success); transform: scale(1.1); }
    
    #txtUserCod, #txtPassCod {
        padding-left: 45px; padding-right: 45px;
    }

    /* GRID DE MARCAS */
    .services-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-top: 5px;
    }

    .btn-service-brand {
        background: rgba(255,255,255,0.03);
        border: 1px solid #222;
        color: #aaa;
        padding: 15px 10px;
        border-radius: 12px;
        cursor: pointer;
        font-size: 0.8rem;
        font-weight: 700;
        text-transform: uppercase;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
        transition: 0.3s;
    }

    .brand-icon { font-size: 1.2rem; font-family: 'Righteous', cursive; }

    /* Colores por Marca */
    .btn-service-brand[data-brand="Disney"]:hover:not(:disabled) { border-color: #006aff; color: #fff; background: rgba(0,106,255,0.1); }
    .btn-service-brand[data-brand="Disney"].active { background: #006aff; color: #fff; border-color: #006aff; box-shadow: 0 0 15px rgba(0,106,255,0.4); }

    .btn-service-brand[data-brand="HBO"]:hover:not(:disabled) { border-color: #7e00e6; color: #fff; background: rgba(126,0,230,0.1); }
    .btn-service-brand[data-brand="HBO"].active { background: #7e00e6; color: #fff; border-color: #7e00e6; box-shadow: 0 0 15px rgba(126,0,230,0.4); }

    .btn-service-brand[data-brand="Amazon"]:hover:not(:disabled) { border-color: #ff9900; color: #fff; background: rgba(255,153,0,0.1); }
    .btn-service-brand[data-brand="Amazon"].active { background: #ff9900; color: #000; border-color: #ff9900; box-shadow: 0 0 15px rgba(255,153,0,0.4); }

    .btn-service-brand[data-brand="Crunchyroll"]:hover:not(:disabled) { border-color: #f47521; color: #fff; background: rgba(244,117,33,0.1); }
    .btn-service-brand[data-brand="Crunchyroll"].active { background: #f47521; color: #000; border-color: #f47521; box-shadow: 0 0 15px rgba(244,117,33,0.4); }

    /* STATUS Y RESULTADOS */
    .status-msg-cod {
        display: flex; align-items: center; justify-content: center; gap: 10px;
        padding: 15px; border-radius: 12px; font-size: 0.85rem; font-weight: 700;
        text-align: center; line-height: 1.4;
    }
    .status-msg-cod.info-cod { background: rgba(124, 58, 237, 0.1); border: 1px solid var(--accent); color: #fff; }
    .status-msg-cod.error { background: rgba(255, 0, 85, 0.1); border: 1px solid #ff0055; color: #ff4d88; }
    .status-msg-cod.success { background: rgba(0, 255, 136, 0.1); border: 1px solid var(--success); color: var(--success); }

    .result-container-cod {
        margin-top: 20px; background: #000; border: 2px solid var(--success);
        border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 0 20px rgba(0,255,136,0.1);
    }
    .result-label { font-size: 0.7rem; color: var(--success); font-weight: 800; letter-spacing: 2px; margin-bottom: 10px; }
    .code-display { font-family: 'monospace'; color: var(--success); text-shadow: 0 0 15px rgba(0,255,136,0.5); word-break: break-all; }
    .fecha-msg { margin-top: 15px; font-size: 0.75rem; color: #888; display: flex; align-items: center; justify-content: center; gap: 5px; }

    /* ENLACES Y BOTONES */
    .btn-link-neon {
        display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        background: var(--success); color: #000; padding: 12px 20px; border-radius: 50px;
        font-weight: 800; text-decoration: none; margin-top: 10px; transition: 0.3s;
    }
    .btn-link-neon:hover { background: #fff; transform: scale(1.05); box-shadow: 0 0 20px rgba(0,255,136,0.6); }

    .fallback-msg { text-align: center; }
    .btn-manual-request {
        display: inline-flex; align-items: center; justify-content: center; gap: 5px;
        margin-top: 10px; padding: 10px 20px; background: #111; color: #fff;
        text-decoration: none; border-radius: 8px; font-size: 0.8rem; font-weight: 600;
        border: 1px solid #333; transition: 0.3s;
    }
    .btn-manual-request:hover { background: #222; border-color: var(--accent); color: var(--accent); }

    .fa-spin { animation: spin 1s infinite linear; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
`;

const styleSheetCodigos = document.createElement("style");
styleSheetCodigos.innerText = codigosStyles;
document.head.appendChild(styleSheetCodigos);
</script>
<script id="script-datos.js">
    /* datos.js */
/**
 * ===============================================================
 * DATOS.JS - GESTI√ìN DE PERFIL (CACH√â INTELIGENTE 5M / 24H)
 * ===============================================================
 */

const TIEMPO_CACHE_INCOMPLETO = 5 * 60 * 1000; // 5 Minutos
const TIEMPO_CACHE_COMPLETO = 24 * 60 * 60 * 1000; // 24 Horas

async function cargarDatos() {
    const container = document.getElementById('sec-datos');
    if (!container) return;

    // 1. Renderizamos la estructura base
    container.innerHTML = `
        <div class="datos-wrapper-premium">
            <div class="page-header-premium" style="text-align: center; margin-bottom: 30px;">
                <h1 class="page-title">MI <span>PERFIL</span></h1>
                <p class="page-subtitle">Gestiona tu informaci√≥n personal y opciones de recuperaci√≥n.</p>
            </div>

            <div class="card-datos">
                <div id="loading-datos" style="text-align:center; padding: 40px;">
                    <div class="spinner"></div>
                    <p style="color:#777; margin-top:15px; font-size:0.85rem; letter-spacing:2px;">CARGANDO DATOS...</p>
                </div>

                <form id="form-datos-perfil" class="hidden" onsubmit="actualizarMisDatos(event)">
                    
                    <div class="datos-grid">
                        <div class="input-group-premium">
                            <label>NOMBRE</label>
                            <div class="datos-input-wrapper">
                                <span class="material-icons-round datos-input-icon">badge</span>
                                <input type="text" id="perfil-nombre" class="datos-input" placeholder="Tu nombre">
                            </div>
                        </div>

                        <div class="input-group-premium">
                            <label>APELLIDO</label>
                            <div class="datos-input-wrapper">
                                <span class="material-icons-round datos-input-icon">badge</span>
                                <input type="text" id="perfil-apellido" class="datos-input" placeholder="Tu apellido">
                            </div>
                        </div>
                    </div>

                    <div class="input-group-premium" style="margin-top: 20px;">
                        <label>CORREO DE RECUPERACI√ìN</label>
                        <div class="datos-input-wrapper">
                            <span class="material-icons-round datos-input-icon">mark_email_read</span>
                            <input type="email" id="perfil-correo" class="datos-input" placeholder="correo@alternativo.com">
                        </div>
                        <p class="datos-help-text">Se usar√° para restablecer tu contrase√±a si la olvidas.</p>
                    </div>

                    <div class="input-group-premium" style="margin-top: 20px;">
                        <label>TEL√âFONO / WHATSAPP</label>
                        <div class="datos-input-wrapper">
                            <span class="material-icons-round datos-input-icon">phone_iphone</span>
                            <input type="tel" id="perfil-telefono" class="datos-input" placeholder="+57 300 000 0000">
                        </div>
                    </div>

                    <button type="submit" class="btn-submit-datos" id="btn-guardar-datos">
                        <span class="material-icons-round">save</span> GUARDAR CAMBIOS
                    </button>

                    <p id="datos-cooldown-msg" class="hidden" style="color: #ff9900; font-size: 0.8rem; text-align: center; margin-top: 15px; font-weight: bold;"></p>
                </form>
            </div>
        </div>
    `;

    // 2. L√ìGICA DE CACH√â
    const rawCache = localStorage.getItem('jeico_perfil_datos_v2');
    const u = localStorage.getItem('jeico_user');
    const t = localStorage.getItem('jeico_token');
    
    if (rawCache) {
        try {
            const cache = JSON.parse(rawCache);
            const edadCache = Date.now() - cache.timestamp;
            
            // Verificamos si los datos est√°n llenos
            const estaLleno = (cache.datos.nombre && cache.datos.apellido && cache.datos.correo && cache.datos.telefono);
            const validezNecesaria = estaLleno ? TIEMPO_CACHE_COMPLETO : TIEMPO_CACHE_INCOMPLETO;

            if (edadCache < validezNecesaria) {
                document.getElementById('perfil-nombre').value = cache.datos.nombre || "";
                document.getElementById('perfil-apellido').value = cache.datos.apellido || "";
                document.getElementById('perfil-correo').value = cache.datos.correo || "";
                document.getElementById('perfil-telefono').value = cache.datos.telefono || "";
                
                document.getElementById('loading-datos').classList.add('hidden');
                document.getElementById('form-datos-perfil').classList.remove('hidden');
                
                console.log(`Carga offline. Perfil ${estaLleno ? 'Completo (24h)' : 'Incompleto (5m)'}.`);
                return; // Cortamos ejecuci√≥n: CERO peticiones al servidor
            }
        } catch (e) {
            localStorage.removeItem('jeico_perfil_datos_v2');
        }
    }

    // 3. CONSULTA AL SERVIDOR (Solo si no hay cach√© o ya expir√≥)
    try {
        console.log("Consultando servidor para sincronizar perfil...");
        const res = await apiCall({ accion: 'getDatosPerfil', usuario: u, token: t });
        
        document.getElementById('loading-datos').classList.add('hidden');
        document.getElementById('form-datos-perfil').classList.remove('hidden');

        if (res.success && res.datos) {
            document.getElementById('perfil-nombre').value = res.datos.nombre || "";
            document.getElementById('perfil-apellido').value = res.datos.apellido || "";
            document.getElementById('perfil-correo').value = res.datos.correo || "";
            document.getElementById('perfil-telefono').value = res.datos.telefono || "";

            // Guardamos en LocalStorage
            localStorage.setItem('jeico_perfil_datos_v2', JSON.stringify({
                timestamp: Date.now(),
                datos: res.datos
            }));
        }
    } catch (e) {
        if (!rawCache) {
            document.getElementById('loading-datos').innerHTML = "<p style='color:#ff0055;'>Error de conexi√≥n al cargar datos.</p>";
        }
    }
}

async function actualizarMisDatos(e) {
    e.preventDefault();

    const nombre = document.getElementById('perfil-nombre').value.trim();
    const apellido = document.getElementById('perfil-apellido').value.trim();
    const correo = document.getElementById('perfil-correo').value.trim();
    const telefono = document.getElementById('perfil-telefono').value.trim();

    // 1. VALIDACI√ìN ESTRICTA: Todos los campos requeridos
    if (!nombre || !apellido || !correo || !telefono) {
        return Swal.fire({
            icon: 'warning',
            title: 'Faltan Datos',
            text: 'Debes completar todos los campos para poder guardar los cambios.',
            background: '#0a0a0a', color: '#fff', confirmButtonColor: 'var(--accent)'
        });
    }

    const btn = document.getElementById('btn-guardar-datos');
    btn.innerHTML = '<span class="material-icons-round fa-spin">sync</span> GUARDANDO...';
    btn.disabled = true;

    const u = localStorage.getItem('jeico_user');
    const t = localStorage.getItem('jeico_token');

    try {
        const res = await apiCall({ 
            accion: 'setDatosPerfil', 
            usuario: u, 
            token: t,
            nombre, apellido, correo, telefono
        });

        if (res.success) {
            // ACTUALIZAMOS LOCALSTORAGE E INICIAMOS ENFRIAMIENTO DE 1 D√çA
            localStorage.setItem('jeico_perfil_datos_v2', JSON.stringify({
                timestamp: Date.now(),
                datos: { nombre, apellido, correo, telefono }
            }));

            Swal.fire({
                toast: true, position: 'top-end', icon: 'success',
                title: 'Perfil Guardado',
                text: 'Los datos se sincronizaron correctamente.',
                showConfirmButton: false, timer: 3000,
                background: '#0a0a0a', color: '#fff'
            });
        } else {
            Swal.fire({ icon: 'error', title: 'Error', text: res.msg, background: '#0a0a0a', color: '#fff' });
        }
    } catch (error) {
        Swal.fire({ icon: 'error', title: 'Error de Red', text: 'No se pudo conectar con el servidor.', background: '#0a0a0a', color: '#fff' });
    } finally {
        btn.innerHTML = '<span class="material-icons-round">save</span> GUARDAR CAMBIOS';
        btn.disabled = false;
    }
}

/**
 * ESTILOS INTEGRADOS
 */
const datosStyles = `
    .datos-wrapper-premium {
        max-width: 650px;
        margin: 0 auto;
        padding: 20px;
    }

    .card-datos {
        background: linear-gradient(145deg, #0a0a0a 0%, #050505 100%);
        border: 1px solid #1a1a1a;
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 20px 50px rgba(0,0,0,0.8);
    }

    .datos-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    .input-group-premium {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .input-group-premium label {
        color: var(--accent);
        font-size: 0.75rem;
        font-weight: 800;
        letter-spacing: 1px;
    }

    .datos-input-wrapper {
        position: relative;
        display: flex;
        align-items: center;
    }

    .datos-input-icon {
        position: absolute;
        left: 15px;
        color: #777;
        font-size: 20px;
        pointer-events: none;
    }

    .datos-input {
        width: 100%;
        box-sizing: border-box; /* FIX APLICADO AQU√ç */
        background: #0d0d0d;
        border: 1px solid #222;
        color: #fff;
        padding: 16px 15px 16px 45px;
        border-radius: 12px;
        font-size: 0.95rem;
        outline: none;
        transition: 0.3s;
    }

    .datos-input:focus {
        border-color: var(--accent);
        box-shadow: 0 0 15px rgba(124, 58, 237, 0.2);
    }

    .btn-submit-datos {
        width: 100%;
        background: var(--accent);
        color: #fff;
        border: none;
        padding: 18px;
        border-radius: 12px;
        font-weight: 800;
        letter-spacing: 1px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        transition: 0.3s;
        margin-top: 30px;
    }

    .btn-submit-datos:hover {
        background: #6d28d9;
        transform: translateY(-3px);
    }

    .fa-spin { animation: spin 1s infinite linear; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    @media (max-width: 600px) {
        .datos-grid { grid-template-columns: 1fr; }
    }
`;

const styleSheetDatos = document.createElement("style");
styleSheetDatos.innerText = datosStyles;
document.head.appendChild(styleSheetDatos);
</script>
<script id="script-contra.js">
    /* contra.js */
/**
 * ===============================================================
 * CONTRA.JS - SISTEMA DE RECUPERACI√ìN BLINDADO (CON CONTADOR)
 * ===============================================================
 */

// Variables temporales para la sesi√≥n de recuperaci√≥n
let usuarioRecuperacionTemp = "";
let correoRecuperacionTemp = "";
let telRecuperacionTemp = "";
let recuEnCooldown = false;

/**
 * 1. MUESTRA LA PANTALLA PARA PEDIR EL CORREO Y TEL√âFONO
 */
function mostrarRecuperacionPaso1() {
    document.getElementById('login-box-main').classList.add('hidden');
    document.getElementById('recover-step-1').classList.remove('hidden');
}

/**
 * 2. REGRESA AL LOGIN PRINCIPAL CANCELANDO LA RECUPERACI√ìN
 */
function volverLogin() {
    document.getElementById('recover-step-1').classList.add('hidden');
    document.getElementById('recover-step-2').classList.add('hidden');
    document.getElementById('login-box-main').classList.remove('hidden');
}

/**
 * 3. PASO 1: VALIDA SI EL CORREO Y TEL√âFONO COINCIDEN EN LA DB
 */
async function enviarSolicitudRecuperacion(e) {
    e.preventDefault();

    if (recuEnCooldown) return; // Si ya est√° bloqueado, no hace nada

    correoRecuperacionTemp = document.getElementById('rec-correo').value.trim();
    telRecuperacionTemp = document.getElementById('rec-tel').value.trim();
    const btn = document.getElementById('btn-recover-1');

    // VALIDACI√ìN PREVIA
    if (!correoRecuperacionTemp.includes('@') || telRecuperacionTemp.length < 7) {
        return Swal.fire({ 
            icon: 'warning', title: 'Datos Inv√°lidos', 
            text: 'Por favor ingresa un correo real y un tel√©fono v√°lido.',
            background: '#0a0a0a', color: '#fff' 
        });
    }

    btn.innerHTML = '<span class="material-icons-round fa-spin">sync</span> VERIFICANDO...';
    btn.disabled = true;

    try {
        const res = await apiCall({ 
            accion: 'validarDatosRecuperacion', 
            correo: correoRecuperacionTemp, 
            telefono: telRecuperacionTemp 
        });

        if (res.success) {
            usuarioRecuperacionTemp = res.usuario; 
            
            document.getElementById('recover-step-1').classList.add('hidden');
            document.getElementById('recover-step-2').classList.remove('hidden');
            
            Swal.fire({ 
                icon: 'success', title: 'Identidad Verificada', 
                text: `Hola ${res.usuario}, ya puedes asignar tu nueva clave.`, 
                background: '#0a0a0a', color: '#fff', 
                confirmButtonColor: '#10b981', timer: 3000
            });
            
            btn.innerText = "ENVIAR DATOS";
            btn.disabled = false;
        } else {
            // FALLO: Activamos el candado visual de 1 minuto
            activarCooldownRecu(btn, "ENVIAR DATOS");
            
            Swal.fire({ 
                icon: 'error', title: 'No encontrado', 
                text: res.msg, 
                background: '#0a0a0a', color: '#fff' 
            });
        }
    } catch (err) {
        btn.innerText = "ENVIAR DATOS";
        btn.disabled = false;
        Swal.fire({ icon: 'error', title: 'Error de Red', text: 'No pudimos conectar con la base de datos.', background: '#0a0a0a', color: '#fff' });
    }
}

/**
 * L√ìGICA DE CONTADOR DIN√ÅMICO
 * Bloquea el bot√≥n y muestra los segundos restantes
 */
function activarCooldownRecu(btn, textoOriginal) {
    recuEnCooldown = true;
    btn.disabled = true;
    btn.classList.add('btn-locked');
    
    let segundos = 60;

    const interval = setInterval(() => {
        segundos--;
        btn.innerHTML = `<span class="material-icons-round">lock</span> ESPERA ${segundos}s`;

        if (segundos <= 0) {
            clearInterval(interval);
            recuEnCooldown = false;
            btn.disabled = false;
            btn.innerText = textoOriginal;
            btn.classList.remove('btn-locked');
        }
    }, 1000);
}

/**
 * 4. PASO 2: ENV√çA LA NUEVA CLAVE
 */
async function procesarNuevaClave(e) {
  e.preventDefault();
  
  const nuevaClave = document.getElementById('rec-nueva-clave').value.trim();
  const btn = document.getElementById('btn-recover-2');

  if(nuevaClave.length < 4) {
      return Swal.fire({ icon: 'warning', title: 'Clave muy corta', text: 'M√≠nimo 4 caracteres.', background: '#0a0a0a', color: '#fff' });
  }

  btn.innerHTML = '<span class="material-icons-round fa-spin">sync</span> ACTUALIZANDO...';
  btn.disabled = true;

  try {
      const res = await apiCall({ 
          accion: 'cambiarClaveOlvidada', 
          usuario: usuarioRecuperacionTemp, 
          correo: correoRecuperacionTemp,
          telefono: telRecuperacionTemp,
          nuevaClave: nuevaClave 
      });

      if (res.success) {
          Swal.fire({ 
              icon: 'success', title: '¬°Proceso Exitoso!', 
              text: 'Tu contrase√±a ha sido actualizada. Ya puedes iniciar sesi√≥n.', 
              background: '#0a0a0a', color: '#fff', confirmButtonColor: '#7c3aed' 
          }).then(() => {
              document.getElementById('rec-correo').value = "";
              document.getElementById('rec-tel').value = "";
              document.getElementById('rec-nueva-clave').value = "";
              usuarioRecuperacionTemp = "";
              volverLogin();
          });
      } else {
          activarCooldownRecu(btn, "ACTUALIZAR CLAVE");
          Swal.fire({ icon: 'error', title: 'Error', text: res.msg, background: '#0a0a0a', color: '#fff' });
      }
  } catch (err) {
      btn.innerText = "ACTUALIZAR CLAVE";
      btn.disabled = false;
      Swal.fire({ icon: 'error', title: 'Falla T√©cnica', text: 'No se pudo actualizar.', background: '#0a0a0a', color: '#fff' });
  }
}

/**
 * ===============================================================
 * ESTILOS CSS PARA RECUPERACI√ìN (ACTUALIZADOS CON ESTADO BLOQUEADO)
 * ===============================================================
 */
const contraStyles = `
    #recover-step-1 .input-field, 
    #recover-step-2 .input-field {
        width: 100%;
        box-sizing: border-box; /* PREVIENE QUE EL INPUT SE SALGA DEL CONTENEDOR */
        background: #0d0d0d;
        border: 1px solid #222;
        color: #fff;
        padding: 15px;
        border-radius: 12px;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        outline: none;
        margin-bottom: 10px;
    }

    #recover-step-1 .input-field:focus, 
    #recover-step-2 .input-field:focus {
        border-color: var(--accent);
        box-shadow: 0 0 15px rgba(124, 58, 237, 0.15);
        background: #000;
    }

    .btn-recover {
        width: 100%;
        padding: 16px;
        border-radius: 12px;
        border: none;
        font-weight: 800;
        letter-spacing: 1px;
        cursor: pointer;
        transition: 0.3s;
        margin-top: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

    /* Estilo cuando el bot√≥n est√° bloqueado por el cron√≥metro */
    .btn-recover.btn-locked {
        background: #1a1a1a !important;
        color: #444 !important;
        border: 1px solid #222 !important;
        cursor: not-allowed;
    }

    .fa-spin { animation: spin 1s infinite linear; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    .back-to-login {
        display: block;
        text-align: center;
        margin-top: 20px;
        color: #555;
        font-size: 0.75rem;
        text-decoration: none;
        font-weight: 600;
        letter-spacing: 1px;
        cursor: pointer;
        transition: 0.3s;
    }
    .back-to-login:hover { color: var(--accent); }
`;

const styleSheetContra = document.createElement("style");
styleSheetContra.innerText = contraStyles;
document.head.appendChild(styleSheetContra);
</script>
<script id="script-mistickets.js">
    /**
 * ===============================================================
 * MISTICKETS.JS - SISTEMA OPTIMIZADO (CACHE 30 MIN - SINCRONIZABLE)
 * ===============================================================
 */

let cargandoTickets = false;
// CONFIGURACI√ìN: 30 Minutos de validez para el cach√© de lectura
const TIEMPO_VALIDEZ_CACHE_TICKETS = 30 * 60 * 1000; 

/**
 * 1. FUNCI√ìN PRINCIPAL: Obtener y renderizar los tickets
 * @param {boolean} forzarRecarga - Si es true, ignora el cach√© y pide datos nuevos.
 */
async function cargarMisTickets(forzarRecarga = false) {
    if (cargandoTickets) return;
    cargandoTickets = true;

    const container = document.getElementById('tickets-container');
    if (!container) {
        cargandoTickets = false;
        return;
    }
    
    // CREDENCIALES
    const u = localStorage.getItem('jeico_user');
    const t = localStorage.getItem('jeico_token');

    if (!u || !t) {
        container.innerHTML = `
            <div style="grid-column: 1/-1; text-align:center; padding:40px;">
                <span class="material-icons-round" style="font-size:3rem; color:var(--danger);">error_outline</span>
                <p style="color: var(--danger); font-weight: bold; margin-top: 15px;">Error: No se detecta una sesi√≥n activa.</p>
            </div>`;
        cargandoTickets = false;
        return;
    }

    // --- L√ìGICA DE CACH√â DE 30 MINUTOS ---
    const cacheRaw = localStorage.getItem('jeico_tickets_cache_v30min'); 
    
    if (cacheRaw && !forzarRecarga) {
        try {
            const cache = JSON.parse(cacheRaw);
            const edadCache = Date.now() - cache.timestamp;

            // SI LA CACH√â TIENE MENOS DE 30 MINUTOS, LA USAMOS Y PARAMOS.
            if (edadCache < TIEMPO_VALIDEZ_CACHE_TICKETS) {
                console.log(`‚ôªÔ∏è Usando cach√© local de tickets (Edad: ${Math.round(edadCache/60000)} min).`);
                
                renderMisTickets(cache.datos);
                
                cargandoTickets = false;
                return; // <--- ESCUDO DE ENFRIAMIENTO ACTIVO
            }
        } catch (e) {
            console.warn("Error leyendo cach√© de tickets, se proceder√° a descargar de nuevo.");
        }
    }

    // Solo mostramos spinner si el contenedor est√° vac√≠o para evitar parpadeos feos
    if (!container.querySelector('.ticket-card-premium')) {
        container.innerHTML = `
            <div style="grid-column: 1/-1; text-align:center; padding:60px;">
                <div class="spinner"></div>
                <p style="color:var(--text-gray); margin-top:20px; letter-spacing:2px; font-size:0.8rem;">Conectando con soporte...</p>
            </div>
        `;
    }

    try {
        console.log("üì° Sincronizando historial de tickets con el servidor...");
        // Llamada al backend
        const res = await apiCall({ 
            accion: 'getMisTickets', 
            usuario: u, 
            token: t 
        });

        if (res && res.success) {
            // Guardamos datos + TIMESTAMP actual para la pr√≥xima vez (Activa los 30 min de enfriamiento)
            const objetoCache = {
                timestamp: Date.now(),
                datos: res.datos
            };
            localStorage.setItem('jeico_tickets_cache_v30min', JSON.stringify(objetoCache));
            
            // Renderizamos los datos frescos
            renderMisTickets(res.datos);
        } else {
            // Si falla y no hay nada mostrado, mostramos error
            if (!container.querySelector('.ticket-card-premium')) {
                container.innerHTML = `
                    <div style="grid-column: 1/-1; text-align:center; padding:40px;">
                        <span class="material-icons-round" style="font-size:3rem; color:var(--danger);">dns</span>
                        <p style="color: var(--danger); font-weight: bold; margin-top: 15px;">Error del servidor: ${res ? res.msg : 'Respuesta vac√≠a'}</p>
                        <button onclick="cargarMisTickets(true)" class="btn-retry" style="margin-top:10px; padding:8px 15px; border-radius:5px; border:1px solid #333; background:transparent; color:#fff; cursor:pointer;">Reintentar</button>
                    </div>
                `;
            }
        }
    } catch (error) {
        console.error("Error cr√≠tico en Mis Tickets:", error);
        container.innerHTML = `
            <div style="grid-column: 1/-1; text-align:center; padding:40px;">
                <span class="material-icons-round" style="font-size:3rem; color:var(--danger);">wifi_off</span>
                <p style="color: var(--danger); font-weight: bold; margin-top: 15px;">Fallo en la conexi√≥n</p>
                <button onclick="cargarMisTickets(true)" class="btn-retry" style="margin-top:10px; padding:8px 15px; border-radius:5px; border:1px solid #333; background:transparent; color:#fff; cursor:pointer;">Reintentar</button>
            </div>
        `;
    } finally {
        cargandoTickets = false;
    }
}

/**
 * 2. RENDERIZADO: Construir el HTML de los tickets
 */
function renderMisTickets(tickets) {
    const container = document.getElementById('tickets-container');
    if (!container) return;
    
    try {
        container.innerHTML = ""; 

        if (!tickets || tickets.length === 0) {
            container.innerHTML = `
                <div class="no-orders-container" style="grid-column: 1/-1; text-align: center; padding: 80px 20px; border: 1px dashed #1a1a1a; border-radius: 20px; background: rgba(0,0,0,0.2);">
                    <span class="material-icons-round" style="font-size: 4rem; color: #333; margin-bottom: 15px;">gpp_good</span>
                    <p style="color: #888; font-weight: 800; letter-spacing: 2px; text-transform: uppercase;">Sin Incidencias</p>
                    <small style="color: #555;">No hay reportes activos en tu historial.</small>
                </div>
            `;
            return;
        }

        tickets.forEach(ticket => {
            const estadoSeguro = String(ticket.estado || "Abierto").trim();
            const esAbierto = estadoSeguro.toLowerCase() === 'abierto';
            
            // Colores m√°s vibrantes para el estado
            const colorEstado = esAbierto ? '#ff9900' : '#10b981'; 
            const bgEstado = esAbierto ? 'rgba(255, 153, 0, 0.1)' : 'rgba(16, 185, 129, 0.1)';
            const iconEstado = esAbierto ? 'hourglass_empty' : 'check_circle';
            
            let fechaStr = "Fecha no disponible";
            if (ticket.fecha) {
                const fechaObj = new Date(ticket.fecha);
                fechaStr = fechaObj.toLocaleDateString() + ' - ' + fechaObj.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            }

            let mensajeEstadoFooter = "";
            
            if (esAbierto) {
                mensajeEstadoFooter = `
                    <div class="ticket-closed-badge" style="color: #ff9900;">
                        <span class="material-icons-round" style="font-size:16px;">support_agent</span> EN REVISI√ìN
                    </div>`;
            } else {
                mensajeEstadoFooter = `
                    <div class="ticket-closed-badge" style="color: #10b981;">
                        <span class="material-icons-round" style="font-size:16px;">lock</span> SOLUCIONADO
                    </div>`;
            }

            // Codificamos los textos de forma segura
            const textoCodificado = encodeURIComponent((ticket.contexto || 'Sin detalles.').replace(/'/g, "%27"));
            const respCodificada = encodeURIComponent((ticket.respuesta || '').replace(/'/g, "%27"));

            const card = document.createElement('div');
            card.className = 'ticket-card-premium'; 
            
            card.innerHTML = `
                <div class="ticket-header">
                    <div>
                        <div class="ticket-service-name">${ticket.tipo || 'Reporte de Soporte'}</div>
                        <div class="ticket-date">${fechaStr}</div>
                    </div>
                    <div class="ticket-status-pill" style="background: ${bgEstado}; border-color: ${colorEstado}40;">
                        <span class="material-icons-round" style="color: ${colorEstado};">${iconEstado}</span>
                        <span style="color: ${colorEstado};">${estadoSeguro}</span>
                    </div>
                </div>
                
                <div class="ticket-body">
                    <div class="ticket-detail-btn" onclick="mostrarDetalleModal('${textoCodificado}', '${respCodificada}')">
                        <div class="ticket-detail-label">
                            <span class="material-icons-round">visibility</span> 
                            <span>LEER REPORTE Y RESPUESTA</span>
                        </div>
                        <span class="material-icons-round detail-icon">open_in_new</span>
                    </div>
                </div>

                <div class="ticket-footer">
                    ${mensajeEstadoFooter}
                </div>
            `;
            container.appendChild(card);
        });

    } catch (renderError) {
        container.innerHTML = `
            <div style="grid-column: 1/-1; text-align:center; padding:40px;">
                <p style="color: var(--danger); font-weight: bold;">Error dibujando tickets: ${renderError.message}</p>
            </div>
        `;
    }
}

/**
 * 3. L√ìGICA DE INTERFAZ: Modal para leer el reporte Y LA RESPUESTA
 */
window.mostrarDetalleModal = function(textoCodificado, respCodificada) {
    // Decodificamos y limpiamos
    const textoLimpio = decodeURIComponent(textoCodificado).replace(/%27/g, "'").replace(/</g, "&lt;").replace(/>/g, "&gt;");
    const textoRespuesta = decodeURIComponent(respCodificada).replace(/%27/g, "'").replace(/</g, "&lt;").replace(/>/g, "&gt;");

    let htmlModal = `
        <div class="modal-ticket-section client-msg">
            <div class="modal-ticket-title">
                <span class="material-icons-round">person</span> TU REPORTE:
            </div>
            <div class="modal-ticket-text">${textoLimpio}</div>
        </div>
    `;

    // Si el administrador ha dejado una respuesta
    if (textoRespuesta.trim() !== "") {
        htmlModal += `
            <div class="modal-ticket-section admin-msg">
                <div class="modal-ticket-title">
                    <span class="material-icons-round">support_agent</span> RESPUESTA DE SOPORTE:
                </div>
                <div class="modal-ticket-text">${textoRespuesta}</div>
            </div>
        `;
    } else {
        htmlModal += `
            <div class="modal-ticket-section admin-msg" style="opacity: 0.7;">
                <div class="modal-ticket-title" style="color: #ff9900;">
                    <span class="material-icons-round">hourglass_empty</span> EN ESPERA:
                </div>
                <div class="modal-ticket-text" style="color: #aaa; font-style: italic;">Tu ticket est√° siendo revisado por nuestro equipo. Te responderemos por este medio.</div>
            </div>
        `;
    }

    Swal.fire({
        title: 'Detalle del Ticket',
        html: htmlModal,
        background: '#0a0a0a',
        color: '#fff',
        confirmButtonColor: 'var(--accent)', 
        confirmButtonText: 'CERRAR',
        customClass: {
            popup: 'modal-ticket-premium'
        }
    });
};

/**
 * ===============================================================
 * ESTILOS CSS INYECTADOS V√çA JS (DISE√ëO PREMIUM GOTH)
 * ===============================================================
 */

const ticketStyles = `
    .ticket-card-premium {
        background: #0d0d0d;
        border: 1px solid #1a1a1a;
        border-radius: 16px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        height: 100%;
        min-height: 220px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .ticket-card-premium:hover {
        border-color: #333;
        transform: translateY(-4px);
        box-shadow: 0 10px 30px rgba(124, 58, 237, 0.08);
    }

    .ticket-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        border-bottom: 1px solid #1a1a1a;
        padding-bottom: 15px;
        margin-bottom: 15px;
    }

    .ticket-service-name {
        font-size: 1.1rem;
        color: #fff;
        font-weight: 700;
        letter-spacing: 0.5px;
    }

    .ticket-date {
        font-size: 0.75rem;
        color: #666;
        margin-top: 6px;
        font-family: monospace;
    }

    .ticket-status-pill {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 20px;
        border: 1px solid transparent;
    }
    
    .ticket-status-pill span:first-child { font-size: 1rem; }
    .ticket-status-pill span:last-child { font-size: 0.75rem; font-weight: 800; letter-spacing: 1px; }

    .ticket-body { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; }

    .ticket-detail-btn {
        background: #111;
        border: 1px solid #222;
        border-radius: 10px;
        padding: 12px 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        transition: all 0.2s ease;
        user-select: none;
    }

    .ticket-detail-btn:hover { background: rgba(124, 58, 237, 0.1); border-color: rgba(124, 58, 237, 0.4); }

    .ticket-detail-label { display: flex; align-items: center; gap: 8px; color: #ccc; font-size: 0.75rem; font-weight: 700; letter-spacing: 1px; }

    .ticket-detail-btn:hover .ticket-detail-label, .ticket-detail-btn:hover .detail-icon { color: var(--accent, #7c3aed); }

    .detail-icon { color: #555; font-size: 1.2rem; transition: color 0.2s; }

    .ticket-footer { margin-top: 20px; display: flex; justify-content: flex-end; align-items: center; }

    .ticket-closed-badge {
        font-size: 0.8rem;
        font-weight: 800;
        letter-spacing: 2px;
        display: flex;
        align-items: center;
        gap: 6px;
        background: transparent;
        padding: 5px 0;
    }
    
    .ticket-closed-badge span { font-size: 1.1rem; }

    .modal-ticket-premium { border: 1px solid #222; border-radius: 16px !important; box-shadow: 0 20px 50px rgba(0,0,0,0.5) !important; }

    .modal-ticket-section { text-align: left; padding: 18px; border-radius: 12px; margin-bottom: 15px; }

    .modal-ticket-title { display: flex; align-items: center; gap: 8px; font-weight: 800; font-size: 0.8rem; letter-spacing: 1.5px; margin-bottom: 10px; }

    .modal-ticket-text { font-size: 0.9rem; line-height: 1.6; white-space: pre-wrap; max-height: 30vh; overflow-y: auto; }

    .client-msg { background: #050505; border: 1px solid #1a1a1a; }
    .client-msg .modal-ticket-title { color: var(--accent, #7c3aed); }
    .client-msg .modal-ticket-text { color: #ccc; }

    .admin-msg { background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); }
    .admin-msg .modal-ticket-title { color: #10b981; }
    .admin-msg .modal-ticket-text { color: #e5e7eb; }
`;

const styleSheetTickets = document.createElement("style");
styleSheetTickets.innerText = ticketStyles;
document.head.appendChild(styleSheetTickets);

/**
 * OBSERVADOR DE VISIBILIDAD PARA CARGA AUTOM√ÅTICA
 */
document.addEventListener('DOMContentLoaded', () => {
    const secMisTickets = document.getElementById('sec-mistickets');
    
    if (secMisTickets) {
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.attributeName === 'class') {
                    if (!secMisTickets.classList.contains('hidden')) {
                        cargarMisTickets();
                    }
                }
            });
        });
        observer.observe(secMisTickets, { attributes: true });
    }
});
</script>
<script id="ranking.js">
    /* ranking.js */
/**
 * ===============================================================
 * RANKING.JS - TABLA DE L√çDERES (OPTIMIZADA CON CACH√â DIARIA Y CASCADA)
 * ===============================================================
 */

let cargandoRanking = false;

/**
 * 1. FUNCI√ìN PRINCIPAL: Cargar datos del Ranking
 */
async function cargarRanking() {
    if (cargandoRanking) return;
    cargandoRanking = true;

    // --- PREPARAR CONTENEDOR ---
    const mainSection = document.getElementById('sec-ranking');
    let container = document.getElementById('ranking-content');
    
    if (!container && mainSection) {
        mainSection.innerHTML = '<div id="ranking-content" class="ranking-wrapper"></div>';
        container = document.getElementById('ranking-content');
    }
    
    if (!container) {
        cargandoRanking = false;
        return; 
    }

    // --- L√ìGICA DE CACH√â INTELIGENTE (12 AM RULE) ---
    const hoy = new Date().toLocaleDateString(); // Ej: "19/2/2026"
    const fechaGuardada = localStorage.getItem('jeico_ranking_date');
    const cacheRanking = localStorage.getItem('jeico_ranking_data');
    
    // Verificamos si tenemos datos y si corresponden al d√≠a de hoy
    const datosSonDeHoy = (fechaGuardada === hoy);

    if (cacheRanking && datosSonDeHoy) {
        console.log("Ranking: Cargando desde cach√© (Datos de hoy).");
        const datos = JSON.parse(cacheRanking);
        renderRankingUI(container, datos.top10, datos.miRanking);
        cargandoRanking = false;
        return; // ¬°TERMINAMOS AQU√ç! No consumimos API.
    }

    // --- SI NO HAY CACH√â O ES UN D√çA NUEVO -> CARGAR DEL SERVIDOR ---
    
    // Loader solo si vamos a buscar datos nuevos
    container.innerHTML = `
        <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:300px;">
            <div class="spinner"></div>
            <p style="color:#888; margin-top:20px; font-family: 'Righteous', sans-serif; letter-spacing: 2px;">ACTUALIZANDO POSICIONES...</p>
        </div>
    `;

    try {
        const u = localStorage.getItem('jeico_user');
        const t = localStorage.getItem('jeico_token');

        if (!u || !t) {
            container.innerHTML = `<p style="text-align:center; color:var(--danger);">Sesi√≥n no v√°lida.</p>`;
            cargandoRanking = false;
            return;
        }

        const res = await apiCall({ 
            accion: 'getRanking', 
            usuario: u, 
            token: t 
        });

        if (res && res.success) {
            // Guardamos datos y LA FECHA DE HOY
            localStorage.setItem('jeico_ranking_data', JSON.stringify(res));
            localStorage.setItem('jeico_ranking_date', hoy);
            
            renderRankingUI(container, res.top10, res.miRanking);
        } else {
            // Si falla la red pero ten√≠amos una cach√© vieja (de ayer), la mostramos como respaldo
            if (cacheRanking) {
                const datosViejos = JSON.parse(cacheRanking);
                renderRankingUI(container, datosViejos.top10, datosViejos.miRanking);
                Swal.fire({ toast: true, position: 'top-end', icon: 'warning', title: 'Mostrando datos anteriores (Sin conexi√≥n)', showConfirmButton: false, timer: 3000 });
            } else {
                container.innerHTML = `<p style="text-align:center; color:var(--danger);">Error al cargar el ranking.</p>`;
            }
        }

    } catch (error) {
        if (cacheRanking) {
            const datosViejos = JSON.parse(cacheRanking);
            renderRankingUI(container, datosViejos.top10, datosViejos.miRanking);
        } else {
            container.innerHTML = `<p style="text-align:center; color:var(--danger);">Fallo de conexi√≥n.</p>`;
        }
    } finally {
        cargandoRanking = false;
    }
}

/**
 * 2. RENDERIZADO UI: Construir la interfaz √©pica
 */
function renderRankingUI(container, top10, miData) {
    container.innerHTML = "";

    // --- A. TARJETA DEL USUARIO ACTUAL (MI ESTAD√çSTICA) ---
    const divMiStats = document.createElement('div');
    divMiStats.className = 'my-stats-card';
    
    // Determinar mensaje seg√∫n posici√≥n
    let mensajeAnimo = "¬°Sigue comprando para subir!";
    let iconoPosicion = "trending_up";
    let clasePosicion = "";

    if (miData.posicion === 1) { 
        mensajeAnimo = "¬°ERES EL REY DEL STREAMING! üëë"; 
        iconoPosicion = "emoji_events";
        clasePosicion = "rank-1-text";
    } else if (miData.posicion > 0 && miData.posicion <= 3) {
        mensajeAnimo = "¬°Est√°s en el podio! Mant√©n el ritmo.";
        iconoPosicion = "military_tech";
    } else if (miData.posicion > 0 && miData.posicion <= 10) {
        mensajeAnimo = "¬°Eres un Top Seller! Est√°s en la √©lite.";
        iconoPosicion = "star";
    } else if (miData.posicion === -1 || miData.posicion === 0) {
        mensajeAnimo = "Realiza tu primera compra para entrar al Ranking.";
    }

    divMiStats.innerHTML = `
        <div class="my-stats-header">
            <span class="material-icons-round" style="color:var(--accent);">account_circle</span>
            <span>TU RENDIMIENTO</span>
        </div>
        <div class="my-stats-grid">
            <div class="stat-item">
                <div class="stat-label">POSICI√ìN GLOBAL</div>
                <div class="stat-value ${clasePosicion}">#${miData.posicion > 0 ? miData.posicion : '-'}</div>
            </div>
            <div class="stat-item border-left">
                <div class="stat-label">CUENTAS COMPRADAS</div>
                <div class="stat-value text-accent">${miData.compras || 0}</div>
            </div>
        </div>
        <div class="my-stats-footer">
            <span class="material-icons-round">${iconoPosicion}</span> ${mensajeAnimo}
        </div>
    `;
    container.appendChild(divMiStats);

    // --- B. LISTA DEL TOP 10 ---
    const divLeaderboard = document.createElement('div');
    divLeaderboard.className = 'leaderboard-container';
    
    let htmlList = `<h3 class="leaderboard-title">üèÜ TOP 10 L√çDERES</h3><div class="leaderboard-list">`;

    if(top10.length === 0) {
        htmlList += `<p style="text-align:center; padding:20px; color:#666;">A√∫n no hay datos registrados hoy.</p>`;
    } else {
        top10.forEach((user, index) => {
            const rank = index + 1;
            let rankClass = "rank-item";
            let iconHtml = `<span class="rank-number">#${rank}</span>`;
            
            // Estilos especiales para el podio
            if (rank === 1) {
                rankClass += " rank-gold";
                iconHtml = `<span class="material-icons-round medal-icon gold">emoji_events</span>`;
            } else if (rank === 2) {
                rankClass += " rank-silver";
                iconHtml = `<span class="material-icons-round medal-icon silver">military_tech</span>`;
            } else if (rank === 3) {
                rankClass += " rank-bronze";
                iconHtml = `<span class="material-icons-round medal-icon bronze">military_tech</span>`;
            }

            // Resaltar si soy yo
            if (user.usuario === miData.usuario) {
                rankClass += " its-me";
            }

            // Animaci√≥n en cascada inline
            const delay = index * 0.08;

            htmlList += `
                <div class="${rankClass}" style="animation-delay: ${delay}s;">
                    <div class="rank-left">
                        ${iconHtml}
                        <span class="rank-name">${user.usuario}</span>
                    </div>
                    <div class="rank-right">
                        <span class="rank-score">${user.compras}</span>
                        <span class="rank-label">Ventas</span>
                    </div>
                </div>
            `;
        });
    }

    htmlList += `</div>`;
    divLeaderboard.innerHTML = htmlList;
    container.appendChild(divLeaderboard);

    // --- C. DISCLAIMER DE ACTUALIZACI√ìN ---
    const divDisclaimer = document.createElement('div');
    divDisclaimer.className = 'ranking-disclaimer';
    divDisclaimer.innerHTML = `
        <span class="material-icons-round" style="font-size: 1rem;">update</span>
        Los datos se actualizan autom√°ticamente todos los d√≠as a las 12:00 AM (Medianoche).
    `;
    container.appendChild(divDisclaimer);
}

/**
 * ===============================================================
 * ESTILOS CSS PREMIUM (INYECTADOS)
 * ===============================================================
 */
const rankingStyles = `
    .ranking-wrapper {
        padding: 10px;
        max-width: 800px;
        margin: 0 auto;
        animation: fadeIn 0.5s ease;
    }

    /* --- DISCLAIMER --- */
    .ranking-disclaimer {
        margin-top: 20px;
        text-align: center;
        font-size: 0.75rem;
        color: #666;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        background: rgba(255, 255, 255, 0.02);
        padding: 10px;
        border-radius: 8px;
        border: 1px dashed #333;
    }

    /* --- MI TARJETA --- */
    .my-stats-card {
        background: linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%);
        border: 1px solid #333;
        border-radius: 16px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        position: relative;
        overflow: hidden;
    }
    
    /* Efecto de brillo superior */
    .my-stats-card::before {
        content: '';
        position: absolute;
        top: 0; left: 0; width: 100%; height: 4px;
        background: linear-gradient(90deg, var(--accent), #b721ff);
    }

    .my-stats-header {
        display: flex;
        align-items: center;
        gap: 10px;
        font-family: 'Righteous', sans-serif;
        color: #fff;
        font-size: 1.2rem;
        margin-bottom: 20px;
        opacity: 0.9;
    }

    .my-stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    .stat-item {
        text-align: center;
    }
    
    .border-left {
        border-left: 1px solid rgba(255,255,255,0.1);
    }

    .stat-label {
        color: #666;
        font-size: 0.7rem;
        font-weight: 800;
        letter-spacing: 2px;
        margin-bottom: 5px;
    }

    .stat-value {
        font-size: 2.5rem;
        font-weight: 800;
        color: #fff;
        line-height: 1;
    }
    
    .text-accent { color: var(--accent); text-shadow: 0 0 20px rgba(124, 58, 237, 0.4); }
    .rank-1-text { color: #FFD700; text-shadow: 0 0 20px rgba(255, 215, 0, 0.6); }

    .my-stats-footer {
        margin-top: 20px;
        background: rgba(255,255,255,0.03);
        padding: 10px;
        border-radius: 8px;
        text-align: center;
        font-size: 0.85rem;
        color: #aaa;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    /* --- LEADERBOARD --- */
    .leaderboard-container {
        background: #000;
        border-radius: 16px;
        border: 1px solid #222;
        padding: 20px;
    }

    .leaderboard-title {
        text-align: center;
        font-family: 'Righteous', sans-serif;
        color: #fff;
        margin-top: 0;
        margin-bottom: 20px;
        letter-spacing: 1px;
        text-transform: uppercase;
        background: -webkit-linear-gradient(#fff, #888);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .leaderboard-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .rank-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: #111;
        padding: 12px 15px;
        border-radius: 10px;
        border: 1px solid transparent;
        transition: transform 0.2s;
        /* Animaci√≥n de Cascada */
        opacity: 0;
        animation: slideInRight 0.4s ease forwards;
    }
    
    .rank-item:hover {
        transform: translateX(5px);
        background: #161616;
    }

    .rank-left { display: flex; align-items: center; gap: 15px; }
    .rank-right { text-align: right; display: flex; flex-direction: column; align-items: flex-end; }

    .rank-number {
        font-family: 'Righteous', sans-serif;
        color: #444;
        font-size: 1.2rem;
        width: 30px;
        text-align: center;
    }

    .rank-name {
        font-weight: 600;
        color: #eee;
        font-size: 0.95rem;
    }

    .rank-score {
        font-weight: 800;
        color: #fff;
        font-size: 1.1rem;
    }
    
    .rank-label {
        font-size: 0.6rem;
        color: #555;
        text-transform: uppercase;
        font-weight: 700;
    }

    /* --- MEDALLAS Y COLORES --- */
    .medal-icon { font-size: 1.5rem; width: 30px; text-align: center; }
    .gold { color: #FFD700; filter: drop-shadow(0 0 5px rgba(255,215,0,0.5)); }
    .silver { color: #C0C0C0; filter: drop-shadow(0 0 5px rgba(192,192,192,0.5)); }
    .bronze { color: #CD7F32; filter: drop-shadow(0 0 5px rgba(205,127,50,0.5)); }

    /* Estilos de fila Top 3 */
    .rank-gold {
        background: linear-gradient(90deg, rgba(255,215,0,0.1), transparent);
        border: 1px solid rgba(255,215,0,0.3);
    }
    .rank-silver {
        background: linear-gradient(90deg, rgba(192,192,192,0.05), transparent);
        border: 1px solid rgba(192,192,192,0.2);
    }
    .rank-bronze {
        background: linear-gradient(90deg, rgba(205,127,50,0.05), transparent);
        border: 1px solid rgba(205,127,50,0.2);
    }

    /* Highlight del propio usuario */
    .its-me {
        border: 1px solid var(--accent);
        box-shadow: 0 0 15px rgba(124, 58, 237, 0.2) inset;
    }
    .its-me .rank-name { color: var(--accent); }

    /* Animaciones Generales */
    @keyframes slideInRight {
        from { opacity: 0; transform: translateX(20px); }
        to { opacity: 1; transform: translateX(0); }
    }
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
`;

const styleSheetRanking = document.createElement("style");
styleSheetRanking.innerText = rankingStyles;
document.head.appendChild(styleSheetRanking);

// --- OBSERVER PARA CARGAR AL ABRIR LA PESTA√ëA ---
document.addEventListener('DOMContentLoaded', () => {
    const secRanking = document.getElementById('sec-ranking');
    
    if (secRanking) {
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.attributeName === 'class') {
                    if (!secRanking.classList.contains('hidden')) {
                        cargarRanking();
                    }
                }
            });
        });
        observer.observe(secRanking, { attributes: true });
    }
});
</script>
</body>
</html>
